System.register(["jimu-core","jimu-arcgis","jimu-ui","esri/Basemap","esri/widgets/BasemapGallery","esri/portal/Portal","esri/widgets/BasemapGallery/BasemapGalleryViewModel","esri/widgets/BasemapGallery/support/BasemapGalleryItem"],(function(e,t){var r={},n={},i={},s={},o={},l={},a={},c={};return{setters:[function(e){r.MutableStoreManager=e.MutableStoreManager,r.React=e.React,r.ReactRedux=e.ReactRedux,r.classNames=e.classNames,r.css=e.css,r.getAppStore=e.getAppStore,r.hooks=e.hooks,r.jsx=e.jsx},function(e){n.JimuMapViewComponent=e.JimuMapViewComponent,n.basemapUtils=e.basemapUtils},function(e){i.WidgetPlaceholder=e.WidgetPlaceholder},function(e){s.default=e.default},function(e){o.default=e.default},function(e){l.default=e.default},function(e){a.default=e.default},function(e){c.default=e.default}],execute:function(){e((()=>{var e={98782:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><g clip-path="url(#a)"><path fill="#000" fill-rule="evenodd" d="M1 1h7v7H1V1ZM0 9V0h9v9H0Zm12-8h7v7h-7V1Zm-1 8V0h9v9h-9Zm-3 3H1v7h7v-7Zm-8-1v9h9v-9H0Zm12 1h7v7h-7v-7Zm-1 8v-9h9v9h-9Z" clip-rule="evenodd"></path></g><defs><clipPath id="a"><path fill="#fff" d="M0 0h20v20H0z"></path></clipPath></defs></svg>'},63673:e=>{"use strict";e.exports=s},69383:e=>{"use strict";e.exports=l},64946:e=>{"use strict";e.exports=o},37139:e=>{"use strict";e.exports=a},18815:e=>{"use strict";e.exports=c},26826:e=>{"use strict";e.exports=n},48891:e=>{"use strict";e.exports=r},30726:e=>{"use strict";e.exports=i}},t={};function u(r){var n=t[r];if(void 0!==n)return n.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,u),i.exports}u.d=(e,t)=>{for(var r in t)u.o(t,r)&&!u.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},u.p="";var d={};return u.p=window.jimuConfig.baseUrl,(()=>{"use strict";u.r(d),u.d(d,{__set_webpack_public_path__:()=>m,default:()=>v});var e,t=u(48891),r=u(26826),n=u(30726);!function(e){e.Organization="ORGANIZATION",e.Custom="CUSTOM"}(e||(e={}));var i=u(63673),s=u(64946),o=u(69383),l=u(37139),a=u(18815),c=function(e,t,r,n){return new(r||(r=Promise))((function(i,s){function o(e){try{a(n.next(e))}catch(e){s(e)}}function l(e){try{a(n.throw(e))}catch(e){s(e)}}function a(e){var t;e.done?i(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,l)}a((n=n.apply(e,t||[])).next())}))};const p=u(98782),v=u=>{const{useMapWidgetIds:d,config:v,id:m,theme:f,mutableStateProps:g}=u,{basemapsType:w,customBasemaps:h}=v,M=t.hooks.usePrevious(w),b=t.hooks.usePrevious(h),y=t.hooks.useLatest(h),x=t.React.useRef(null);x.current=w;const R=t.React.useRef(null),B=t.React.useRef(null),S=t.React.useRef(null),[I,j]=t.React.useState(!1),P=t.React.useRef(null),C=t.React.useRef({}),V=t.React.useRef({}),O=t.React.useMemo((()=>(null==g?void 0:g.cachedOrgBasemaps)||null),[null==g?void 0:g.cachedOrgBasemaps]),_=t.React.useCallback((e=>{t.MutableStoreManager.getInstance().updateStateValue(m,"cachedOrgBasemaps",e)}),[m]),E=t.React.useMemo((()=>(null==g?void 0:g.cachedBaseMapGallery)||null),[null==g?void 0:g.cachedBaseMapGallery]),G=t.React.useCallback((e=>{t.MutableStoreManager.getInstance().updateStateValue(m,"cachedBaseMapGallery",e)}),[m]);t.React.useEffect((()=>{if(null!==E){const e=E.currentViewId,t=E.galleries[e];for(const e in E.galleries)V.current[e]=E.galleries[e],C.current[e]=E.originalBasemaps[e];const r=t.container;P.current&&0===P.current.childElementCount&&r&&P.current.appendChild(r)}}),[]);const k=t.ReactRedux.useSelector((e=>{var t,r;const n=null!==(t=e.appStateInBuilder)&&void 0!==t?t:e;return d?null===(r=n.appConfig.widgets[d[0]])||void 0===r?void 0:r.useDataSources:[]}));t.React.useEffect((()=>{if(C.current&&k)for(const e in C.current){const t=e.split("-")[1];k.some((e=>e.dataSourceId===t))||(V.current[e]&&(V.current[e].viewModel.activeBasemap=C.current[e],delete V.current[e]),delete C.current[e])}}),[k]);const N=e=>{const t=e.split("-")[0];for(const e in V.current)t!==e.split("-")[0]&&(V.current[e].viewModel.activeBasemap=C.current[e],delete V.current[e])},Z=e=>c(void 0,void 0,void 0,(function*(){const t=new i.default({portalItem:{id:e.id}}),r=yield t.load();return Promise.resolve(r)})),U=e=>{const t=[];return e.forEach((e=>c(void 0,void 0,void 0,(function*(){const r=Z(e);t.push(r)})))),t},A=()=>c(void 0,void 0,void 0,(function*(){let n=[];if(w===e.Organization)n=yield c(void 0,void 0,void 0,(function*(){if(null!==O)return O;let e=[];const n=(0,t.getAppStore)().getState().portalUrl,i=new o.default({url:n}),s=yield(e=>e.load().then((()=>c(void 0,void 0,void 0,(function*(){return Promise.resolve(e.sourceJSON)}))),(()=>c(void 0,void 0,void 0,(function*(){return Promise.reject(null)})))))(i);if(q())return e;const l=yield r.basemapUtils.getBasemapGroup(i,s,!1);if(q())return e;const a=null==l?void 0:l.id;e=yield r.basemapUtils.getBasemapItemsByGroupId(i,n,a);const u=U(e),d=yield Promise.all(u);return _(d),d}));else{const e=U(h);n=yield Promise.all(e)}if(!q())return n})),H=e=>c(void 0,void 0,void 0,(function*(){if(!J())return;j(!1);const t=yield A();if(q())return void j(!0);if(G(null),!V.current[B.current]){const r=document&&document.createElement("div");r.className="esri-component h-100",V.current[B.current]=new s.default({view:e,source:t,container:r,includeCurrentBasemap:!0})}G({galleries:V.current,currentViewId:B.current,originalBasemaps:C.current});const r=V.current[B.current].container;P.current&&(0===P.current.childElementCount?P.current.appendChild(r):P.current.replaceChildren(r)),j(!0)})),T=()=>{const e=V.current[B.current],t=e.viewModel.items.items,r=e.viewModel.activeBasemap;r&&(t.some((e=>S.current.basemapEquals(r,e.basemap)))||(e.viewModel.activeBasemap=C.current[B.current]))},W=()=>c(void 0,void 0,void 0,(function*(){const e=null==b?void 0:b.length,t=h.length>e,r=h.length<e;if(t){const e=function(e,t){const r=new Set(e.map((e=>e.id)));for(let e=0;e<t.length;e++)if(!r.has(t[e].id))return e;return-1}(b,h);yield(e=>c(void 0,void 0,void 0,(function*(){const t=-1!==e?e:h.length-1,r=h[t],n=V.current[B.current],s=new a.default({basemap:new i.default({portalItem:{id:r.id}}),view:n.viewModel.view});n.viewModel.source.basemaps.splice(t,0,new i.default({portalItem:{id:r.id}})),n.viewModel.items.splice(t,0,s);(e=>{const t=V.current[B.current].viewModel.items.items,r=y.current.findIndex((t=>t.id===e.portalItem.id)),n=C.current[B.current];r>=0&&S.current.basemapEquals(n,e)&&t.length>y.current.length&&t.shift()})(yield Z(r))})))(e)}else r?(()=>{var e;let t=!1;const r=V.current[B.current];for(let n=0;n<h.length;n++)if(h[n].id!==(null===(e=b[n])||void 0===e?void 0:e.id)){r.viewModel.source.basemaps.splice(n,1),b.length<r.viewModel.items.length?r.viewModel.items.splice(n+1,1):r.viewModel.items.splice(n,1),t=!0;break}t||(r.viewModel.source.basemaps.splice(h.length,1),b.length<r.viewModel.items.length?r.viewModel.items.splice(h.length+1,1):r.viewModel.items.splice(h.length,1)),(()=>{const e=V.current[B.current],t=e.viewModel.items.items,r=C.current[B.current];if(!t.some((e=>S.current.basemapEquals(r,e.basemap)))){const t=new a.default({basemap:C.current[B.current],view:e.viewModel.view});e.viewModel.items.unshift(t)}})(),T()})():(()=>{const e=V.current[B.current],t=e.viewModel.items.items,r=b.asMutable({deep:!0});let n=!1;for(let i=0;i<h.length;i++){const s=h[i].id,o=r[i].id;if(s!==o){n=!0;const o=r.findIndex((e=>e.id===s)),l=r.splice(o,1);r.splice(i,0,l[0]);const a=e.viewModel.source.basemaps.splice(o,1);if(e.viewModel.source.basemaps.splice(i,0,a[0]),h.length<t.length){const t=e.viewModel.items.splice(o+1,1);e.viewModel.items.splice(i+1,0,t[0])}else{const t=e.viewModel.items.splice(o,1);e.viewModel.items.splice(i,0,t[0])}}else if(n)break}})()})),J=()=>!(void 0===M&&null!=E||!R.current||!S.current)||(j(!0),!1);t.React.useEffect((()=>{null!==B.current&&d&&(null==d?void 0:d.length)<=0&&(()=>{const e=B.current.split("-")[0];for(const t in V.current)e===t.split("-")[0]&&(V.current[t].viewModel.activeBasemap=C.current[t],delete V.current[t],delete C.current[t]);R.current=null,B.current=null,null!=E&&G(null)})()}),[d]),t.React.useEffect((()=>{var e;(null===(e=V.current[B.current])||void 0===e?void 0:e.isFulfilled())?c(void 0,void 0,void 0,(function*(){if(!J())return;j(!1);const e=yield A();if(q())j(!0);else{for(const t in V.current){const r=V.current[t];r.viewModel.activeBasemap=C.current[t],r.viewModel.source=e}G({galleries:V.current,currentViewId:B.current,originalBasemaps:C.current}),j(!0)}})):H(R.current)}),[w]),t.React.useEffect((()=>{var t;(null===(t=V.current[B.current])||void 0===t?void 0:t.isFulfilled())&&w===e.Custom&&J()&&(W(),c(void 0,void 0,void 0,(function*(){const e=yield A();for(const t in V.current)t!==B.current&&(V.current[t].viewModel.source=e)})),G({galleries:V.current,currentViewId:B.current,originalBasemaps:C.current}))}),[h]);const q=()=>w!==x.current;return!d||(null==d?void 0:d.length)<=0?(0,t.jsx)(n.WidgetPlaceholder,{icon:p,widgetId:m,message:u.intl.formatMessage({id:"_widgetLabel",defaultMessage:"Basemap Gallery"})}):(0,t.jsx)("div",{className:"jimu-widget jimu-basemap-widget surface-1 border-0",css:t.css`
    &.jimu-basemap-widget {
      min-width: 240px;
      min-height: 320px;
      .esri-ui-inner-container.esri-ui-corner-container{
        .esri-basemap-gallery.esri-component {
          width:100%;
          background-color: transparent !important;
          .esri-basemap-gallery__item {
            animation: none;
            transition: none;
          }
          .esri-basemap-gallery__item--selected {
            border-color: var(--primary-500);
          }
        }
      }
      .esri-ui-corner .esri-component.esri-widget--panel-height-only {
        max-height: none;
      }
    }
  `},(0,t.jsx)(r.JimuMapViewComponent,{useMapWidgetId:null==d?void 0:d[0],onActiveViewChange:e=>{var t;if(null==e?void 0:e.view){const r=e.id;if(R.current=e.view,B.current=r,N(r),S.current=new l.default({view:e.view}),!C.current[r]&&e.view.map.basemap){const t=e.view.map.basemap;C.current[r]=t}(null===(t=V.current[r])||void 0===t?void 0:t.isFulfilled())&&T(),H(R.current)}}}),(0,t.jsx)("div",{className:(0,t.classNames)("esri-ui-inner-container","esri-ui-corner-container",{"d-none":!I}),role:"listbox"},(0,t.jsx)("div",{className:"esri-ui-corner w-100 h-100",ref:P})),!I&&(0,t.jsx)("div",{className:"jimu-secondary-loading"}))};function m(e){u.p=e}})(),d})())}}}));