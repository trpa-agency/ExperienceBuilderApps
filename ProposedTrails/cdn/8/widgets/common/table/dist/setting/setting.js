System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-core/react","jimu-ui/basic/list-tree","jimu-for-builder"],(function(e,t){var i={},a={},s={},o={},l={},n={},r={};return{setters:[function(e){i.CONSTANTS=e.CONSTANTS,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.Immutable=e.Immutable,i.JimuFieldType=e.JimuFieldType,i.React=e.React,i.classNames=e.classNames,i.css=e.css,i.jsx=e.jsx,i.polished=e.polished,i.urlUtils=e.urlUtils},function(e){a.Alert=e.Alert,a.Button=e.Button,a.Checkbox=e.Checkbox,a.Icon=e.Icon,a.Label=e.Label,a.MultiSelect=e.MultiSelect,a.Select=e.Select,a.Switch=e.Switch,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.defaultMessages=e.defaultMessages},function(e){s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection,s.SidePopper=e.SidePopper},function(e){o.AllDataSourceTypes=e.AllDataSourceTypes,o.DataSourceSelector=e.DataSourceSelector,o.FieldSelector=e.FieldSelector,o.dataComponentsUtils=e.dataComponentsUtils},function(e){l.Fragment=e.Fragment},function(e){n.List=e.List,n.TreeItemActionType=e.TreeItemActionType,n.TreeType=e.TreeType},function(e){r.builderAppSync=e.builderAppSync}],execute:function(){e((()=>{var e={748:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.5c0 .527-.074 1.036-.212 1.518l.912.438a6.5 6.5 0 10-6.586 4.533l-.077-1.008A5.5 5.5 0 1112 6.5zm-9 0a3.501 3.501 0 002.88 3.445L5.8 8.901a2.501 2.501 0 113.194-2.224l.949.456A3.5 3.5 0 103 6.5zM15.5 11l-5 1-3 4-1-9.5 9 4.5zm-5.57.094l-1.702 2.269-.542-5.152 4.76 2.38-2.517.503z" fill="#000"></path></svg>'},55339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.745 8l6.1 6.1a.527.527 0 11-.745.746L8 8.746l-6.1 6.1a.527.527 0 11-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 01.746-.746l6.1 6.1 6.1-6.1a.527.527 0 01.746.746L8.746 8z" fill="#000"></path></svg>'},28676:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA5IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA5IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjkzIiBoZWlnaHQ9IjU0IiByeD0iMiIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMzIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMzIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMTIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjEyIiB3aWR0aD0iMzgiIGhlaWdodD0iOCIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMTQiIHk9IjE0IiB3aWR0aD0iMjgiIGhlaWdodD0iNCIgZmlsbD0iIzE4MTgxOCIvPg0KPHBhdGggZD0iTTQ0IDE1SDQ4TDQ2IDE3TDQ0IDE1WiIgZmlsbD0iIzE4MTgxOCIvPg0KPHJlY3QgeD0iNTIiIHk9IjI0IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNTIiIHk9IjMyIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjM5IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjQ2IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjUzIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjI0IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNzMiIHk9IjMyIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjM5IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjQ2IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjUzIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPC9zdmc+DQo="},32253:e=>{e.exports="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTA5IiBoZWlnaHQ9IjcwIiB2aWV3Qm94PSIwIDAgMTA5IDcwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPg0KPHJlY3QgeD0iOCIgeT0iOCIgd2lkdGg9IjkzIiBoZWlnaHQ9IjU0IiByeD0iMiIgZmlsbD0iIzI4MjgyOCIvPg0KPHJlY3QgeD0iMzIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMzIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMzIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjI0IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iMTIiIHk9IjMyIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjM5IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjQ2IiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjUzIiB3aWR0aD0iMTYiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjE5IiB3aWR0aD0iODUiIGhlaWdodD0iMSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iMTIiIHk9IjE5IiB3aWR0aD0iMTYiIGhlaWdodD0iMSIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMTIiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzZBNkE2QSIvPg0KPHJlY3QgeD0iMzAiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNDgiIHk9IjEzIiB3aWR0aD0iMTYiIGhlaWdodD0iNiIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjI0IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNTIiIHk9IjMyIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjM5IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjQ2IiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNTIiIHk9IjUzIiB3aWR0aD0iMTciIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjI0IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzUyNTI1MiIvPg0KPHJlY3QgeD0iNzMiIHk9IjMyIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjM5IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjQ2IiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPHJlY3QgeD0iNzMiIHk9IjUzIiB3aWR0aD0iMjQiIGhlaWdodD0iNSIgZmlsbD0iIzM2MzYzNiIvPg0KPC9zdmc+DQo="},48891:e=>{"use strict";e.exports=i},51315:e=>{"use strict";e.exports=l},23137:e=>{"use strict";e.exports=r},30726:e=>{"use strict";e.exports=a},338:e=>{"use strict";e.exports=o},77756:e=>{"use strict";e.exports=s},59587:e=>{"use strict";e.exports=n}},t={};function d(i){var a=t[i];if(void 0!==a)return a.exports;var s=t[i]={exports:{}};return e[i](s,s.exports,d),s.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var i in t)d.o(t,i)&&!d.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var c={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(c),d.d(c,{default:()=>M});var e,t,i=d(48891),a=d(30726),s=d(77756),o=d(338);!function(e){e.Dropdown="DROPDOWN",e.Tabs="TABS"}(e||(e={})),function(e){e.Single="SINGLE",e.Multiple="MULTIPLE"}(t||(t={}));const l={newSheet:"New sheet",sheetStyle:"Arrangement style",layerConfig:"Sheet configuration",enableAttachements:"Show attachments",enableSearch:"Search",searchFields:"Select searching fields",fullMatch:"Exact match",allowCsv:"Allow exporting to CSV",enableSelect:"Select records",enableEdit:"Allow editing",enableRefresh:"Refresh",configFields:"Configure fields",dropdown:"Dropdown",configTips:"Select fields for initial display",selectMode:"Select mode",tableBlankStatus:'Click the "{SheetString}" button to add and configure data sheets.',selectFields:"Select fields",checkAll:"Check all",uncheckAll:"Uncheck all",editable:"Editable",editableCount:"{count} Editable"};var n=d(51315),r=d(59587),h=d(23137);const{OUTPUT_DATA_VIEW_ID:g}=i.CONSTANTS;class I extends i.React.PureComponent{constructor(e){super(e),this.supportedDsTypes=(0,i.Immutable)([o.AllDataSourceTypes.FeatureLayer,o.AllDataSourceTypes.SceneLayer]),this.nameChange=e=>{const t=e.target.value;this.setState({itemLabel:t})},this.nameAccept=e=>{(e=""===(e=null==e?void 0:e.trim())?this.props.name:e)!==this.state.itemLabel&&this.setState({itemLabel:e}),this.props.optionChange("name",e)},this.getUncheckState=(e=[],t)=>{var a;let s,o=!1;if(this.state)s=this.state.dataSource;else{if(!t)return o;const e=t.lastIndexOf("-"),a=t.substr(0,e);s=i.DataSourceManager.getInstance().getDataSource(a)}const l=null===(a=s)||void 0===a?void 0:a.getLayerDefinition();return e.forEach((e=>{const t=this.getFieldEditable(l,e.jimuName);!e.editAuthority&&t&&(o=!0)})),o},this.handleCheckboxChange=e=>{const t=e.currentTarget;t&&this.props.optionChange(t.dataset.field,t.checked)},this.formatMessage=(e,t)=>{const i=Object.assign({},l,a.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.displaySelectedFields=e=>this.formatMessage("numSelected",{number:e.length}),this.filterSearchFields=e=>{const{searchFields:t}=this.props,i=t.split(","),a=e.map((e=>e.jimuName));return i.filter((e=>a.includes(e))).join(",")},this.getFieldEditable=(e,t)=>{const i=((null==e?void 0:e.fields)||[]).find((e=>e.name===t));return!i||(null==i?void 0:i.editable)},this.onFieldChange=e=>{var t;if(!e)return;const{dataSource:i}=this.state,a=null===(t=i)||void 0===t?void 0:t.getLayerDefinition(),s=e.filter((e=>e)).map((e=>{const t=this.getFieldEditable(a,e.jimuName);return Object.assign(Object.assign({},e),{editAuthority:t})})),o=this.filterSearchFields(s);this.props.multiOptionsChange({searchFields:o,tableFields:s})},this.onDataSourceCreated=e=>{this.setState({dataSource:e})},this.getSearchingFields=()=>{const e=[],{tableFields:t}=this.props;return t.length>0&&t.forEach((t=>{t.type===i.JimuFieldType.String&&e.push({value:t.jimuName||t.name,label:t.alias||t.name})})),e},this.handleChooseSearchingFieldsChange=(e,t,i)=>{const{widgetId:a}=this.props,s=i.join(",");s||h.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:a,propKey:"optionChangeSuggestion",value:!0}),this.props.optionChange("searchFields",s)},this.getSelectModeOptions=()=>[(0,i.jsx)("option",{key:t.Single,value:t.Single},this.formatMessage("single")),(0,i.jsx)("option",{key:t.Multiple,value:t.Multiple},this.formatMessage("multiple"))],this.getFieldsFromDatasource=()=>{const{useDataSource:e}=this.props,t=i.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId),a=null==t?void 0:t.getSchema(),s=(null==a?void 0:a.fields)?Object.values(null==a?void 0:a.fields):[],o=["CreationDate","Creator","EditDate","Editor","GlobalID"];let l=s.filter((e=>!o.includes(e.jimuName)));return(null==l?void 0:l.length)>50&&(l=l.slice(0,50)),{allFields:s,tableFields:l}},this.checkFieldsExist=(e,t)=>{let i=!1;for(const a of e)if(a.jimuName===t.jimuName){i=!0;break}return i},this.handleListBoxAll=e=>{const{tableFields:t}=this.props,i=t.map((t=>Object.assign(Object.assign({},t),{editAuthority:e})));this.setState({hasUncheck:!e}),this.props.optionChange("tableFields",i)},this.state={dataSource:void 0,itemLabel:e.name||"",hasUncheck:this.getUncheckState(e.tableFields,e.id)},this.colRef=i.React.createRef()}componentDidUpdate(e,t){this.props.name!==e.name&&this.setState({itemLabel:this.props.name||""})}getStyle(e){return i.css`
      .layer-config-panel {
        .panel-inner {
          .title {
            max-width: 70%;
          }
        }
        .setting-container {
          height: calc(100% - ${i.polished.rem(58)});
          overflow: auto;
          .fields-list-header {
            background: ${e.colors.palette.light[200]};
            border-bottom: 1px solid ${e.colors.palette.light[600]};
            height: 34px;
            width: 100%;
            flex-wrap: nowrap;
            .jimu-checkbox {
              margin-top: 2px;
            }
          }
          .selected-fields-con{
            margin-top: 0;
            .selected-fields-list {
              flex: 1;
              max-height: 265px;
              overflow-y: auto;
            }
            .jimu-tree-item{
              background: ${e.colors.palette.light[200]};
              border-bottom: 1px solid ${e.colors.palette.light[300]};
              .jimu-tree-item__content{
                div:first-of-type{
                  padding-left: 2px;
                }
                .jimu-tree-item__body{
                  background: ${e.colors.palette.light[200]};
                }
              }
            }
          }
          .table-options {
            .table-options-item {
              display: flex;
              justify-content: space-between;
              margin-bottom: 8px;
            }
            .select-option {
              margin-bottom: 8px;
            }
          }
          .ds-container {
            position: absolute;
            display: none;
          }
          .component-field-selector {
            .search-input {
              width: 100%;
            }
            .field-list {
              max-height: 300px;
            }
          }
          .config-word-break {
            word-wrap: break-word;
          }
        }
      }
    `}render(){const{useDataSource:e,optionChange:l,theme:d,tableFields:c,searchFields:I,enableEdit:m,widgetId:p}=this.props,{dataSource:u,itemLabel:D,hasUncheck:S}=this.state,b=u&&u.getLayerDefinition(),M=null==u?void 0:u.getSchema(),f=null==c?void 0:c.map((e=>{var t;const i=(null===(t=null==M?void 0:M.fields)||void 0===t?void 0:t[e.jimuName])||{};return Object.assign(Object.assign({},e),i)})),y=[];c&&c.length>0&&c.forEach((e=>{y.push(e.jimuName)}));const{allFields:v}=this.getFieldsFromDatasource(),j=null==b?void 0:b.capabilities;let T=!1;j&&(T=Array.isArray(j)?j.join().toLowerCase().includes("editing"):null==b?void 0:b.capabilities.toLowerCase().includes("editing"));const x=(null==u?void 0:u.url)&&(null==u?void 0:u.dataViewId)!==g&&T,N={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:r.TreeItemActionType.RenderOverrideItem,children:[{name:r.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:r.TreeItemActionType.RenderOverrideItemContent,children:[{name:r.TreeItemActionType.RenderOverrideItemBody,children:[{name:r.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:r.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:r.TreeItemActionType.RenderOverrideItemDragHandle},{name:r.TreeItemActionType.RenderOverrideItemChildrenToggle},{name:r.TreeItemActionType.RenderOverrideItemIcon},{name:r.TreeItemActionType.RenderOverrideItemTitle},{name:r.TreeItemActionType.RenderOverrideItemCommands}]}]},{name:r.TreeItemActionType.RenderOverrideItemDetailLine}]}]}]}]})};let z=0;return null==f||f.forEach((e=>{(null==e?void 0:e.editAuthority)&&z++})),(0,i.jsx)("div",{className:"w-100 h-100",css:this.getStyle(d)},(0,i.jsx)("div",{className:"w-100 h-100 layer-config-panel"},(0,i.jsx)("div",{className:"setting-container"},(0,i.jsx)(s.SettingSection,{title:this.formatMessage("data"),className:"pt-0"},(0,i.jsx)(s.SettingRow,null,(0,i.jsx)(o.DataSourceSelector,{types:this.supportedDsTypes,disableRemove:()=>!0,useDataSources:e?(0,i.Immutable)([e]):(0,i.Immutable)([]),mustUseDataSource:!0,onChange:this.props.dataSourceChange,closeDataSourceListOnChange:!0}))),e&&(0,i.jsx)(i.React.Fragment,null,(0,i.jsx)(s.SettingSection,{title:this.formatMessage("label")},(0,i.jsx)(s.SettingRow,null,(0,i.jsx)(a.TextInput,{type:"text",size:"sm",className:"w-100",value:D,onChange:this.nameChange,onAcceptValue:this.nameAccept,"aria-label":this.formatMessage("label")}))),(0,i.jsx)(s.SettingSection,{title:this.formatMessage("configFields")},(0,i.jsx)(s.SettingRow,null,this.formatMessage("configTips")),(0,i.jsx)(s.SettingRow,null,(0,i.jsx)(o.FieldSelector,{useDataSources:e?(0,i.Immutable)([e]):(0,i.Immutable)([]),onChange:this.onFieldChange,selectedFields:(0,i.Immutable)(y),isMultiple:!0,isSearchInputHidden:!1,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0})),(0,i.jsx)(s.SettingRow,{flow:"wrap",label:m&&this.formatMessage("editableCount",{count:z})},(0,i.jsx)("div",{className:"fields-list-header form-inline"},(0,i.jsx)("div",{className:"d-flex w-100 ml-4 fields-list-check"},m&&(0,i.jsx)(a.Checkbox,{id:"editAllField","data-field":"editAllField",onClick:()=>this.handleListBoxAll(S),checked:!S,title:S?`${this.formatMessage("editable")} (${this.formatMessage("checkAll")})`:`${this.formatMessage("editable")} (${this.formatMessage("uncheckAll")})`}),(0,i.jsx)(a.Label,{for:"editAllField",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("field")},this.formatMessage("field"))))),(0,i.jsx)(s.SettingRow,{className:"selected-fields-con"},(0,i.jsx)(r.List,Object.assign({size:"sm",className:"selected-fields-list",listType:r.TreeType.Intact,itemsJson:Array.from(f).map(((e,t)=>({itemStateDetailContent:e,itemStateChecked:null==e?void 0:e.editAuthority,itemStateDisabled:!this.checkFieldsExist(v,e),itemKey:`${t}`,itemStateIcon:o.dataComponentsUtils.getIconFromFieldType(e.type,d),itemStateTitle:e.alias||e.jimuName||e.name,isCheckboxDisabled:!this.getFieldEditable(b,e.jimuName),itemStateCommands:[]}))),dndEnabled:!0,showCheckbox:m,onUpdateItem:(e,t)=>{const{itemJsons:i}=e,a=i[i.length-1].map((e=>Object.assign(Object.assign({},e.itemStateDetailContent),{editAuthority:e.itemStateChecked})));this.props.optionChange("tableFields",a);const s=this.getUncheckState(a);this.setState({hasUncheck:s})},isItemFocused:()=>!1},N))),x&&(0,i.jsx)(s.SettingRow,null,(0,i.jsx)("div",{className:"d-flex w-100"},(0,i.jsx)(a.Checkbox,{id:"editable-cb","data-field":"enableEdit",onClick:this.handleCheckboxChange,checked:this.props.enableEdit}),(0,i.jsx)(a.Label,{for:"editable-cb",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("enableEdit")},this.formatMessage("enableEdit"))))),(0,i.jsx)(s.SettingSection,{title:this.formatMessage("tools")},(0,i.jsx)("div",{className:"w-100 table-options"},(0,i.jsx)("div",{className:"table-options-item",key:"enableSearch"},(0,i.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage("enableSearch")),(0,i.jsx)(a.Switch,{className:"can-x-switch",checked:this.props.enableSearch||!1,onChange:e=>{const t=e.target.checked;h.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:p,propKey:"optionChangeSuggestion",value:!0}),l("enableSearch",t)}}))),(0,i.jsx)("div",{className:"ds-container"},(0,i.jsx)(i.DataSourceComponent,{useDataSource:(0,i.Immutable)(e),onDataSourceCreated:this.onDataSourceCreated})),this.props.enableSearch&&(0,i.jsx)(s.SettingRow,{flow:"wrap",label:this.formatMessage("searchFields")},(0,i.jsx)("div",{className:"d-flex w-100 search-container",style:{zIndex:3}},(0,i.jsx)(a.MultiSelect,{size:"sm",items:(0,i.Immutable)(this.getSearchingFields()),values:I?(0,i.Immutable)(I.split(",")):(0,i.Immutable)([]),className:"search-multi-select",fluid:!0,onClickItem:this.handleChooseSearchingFieldsChange,displayByValues:this.displaySelectedFields})),(0,i.jsx)("div",{className:"d-flex w-100",style:{marginTop:"10px"}},(0,i.jsx)(a.Checkbox,{id:"fullMatch-cb","data-field":"searchExact",onClick:this.handleCheckboxChange,checked:this.props.searchExact}),(0,i.jsx)(a.Label,{for:"fullMatch-cb",style:{cursor:"pointer"},className:"ml-2",title:this.formatMessage("fullMatch")},this.formatMessage("fullMatch")))),(0,i.jsx)(s.SettingRow,null,(0,i.jsx)("div",{className:"w-100 table-options"},["enableSelect","enableRefresh"].map(((e,o)=>(0,i.jsx)(n.Fragment,{key:o},(0,i.jsx)("div",{className:"table-options-item"},(0,i.jsx)("span",{className:"text-break",style:{width:"80%"}},this.formatMessage(e)),(0,i.jsx)(a.Switch,{className:"can-x-switch",checked:this.props[e]||!1,onChange:t=>{l(e,t.target.checked)}})),"enableSelect"===e&&this.props[e]&&(0,i.jsx)(s.SettingRow,{flow:"wrap",label:this.formatMessage("selectMode"),className:"select-option"},(0,i.jsx)(a.Select,{size:"sm",value:this.props.selectMode||t.Multiple,onChange:e=>{l("selectMode",e.target.value)}},this.getSelectModeOptions()))))))))))))}}class m extends i.React.PureComponent{constructor(){super(...arguments),this.onDataSourceCreated=e=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,e)},this.onCreateDataSourceFailed=()=>{this.props.onCreateDataSourceCreatedOrFailed(this.props.useDataSource.dataSourceId,null)}}render(){return(0,i.jsx)(i.DataSourceComponent,{useDataSource:this.props.useDataSource,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})}}var p=d(55339),u=d.n(p),D=d(748),S=d.n(D);const b=e=>{const{className:t}=e,s=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(i[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(a=Object.getOwnPropertySymbols(e);s<a.length;s++)t.indexOf(a[s])<0&&Object.prototype.propertyIsEnumerable.call(e,a[s])&&(i[a[s]]=e[a[s]])}return i}(e,["className"]),o=(0,i.classNames)("jimu-icon-component",t);return i.React.createElement(a.Icon,Object.assign({className:o,icon:S()},s))};class M extends i.React.PureComponent{constructor(e){super(e),this.sidePopperTrigger=i.React.createRef(),this.updateDsHash=e=>{this.dsHash={};let t=0;e.forEach((e=>{this.dsHash[t]=e.useDataSource,t++}))},this.getNewConfigId=e=>{var t;return`${e}-${((null===(t=this.props.config)||void 0===t?void 0:t.layersConfig.length)>0?this.getArrayMaxId(this.props.config.layersConfig):0)+1}`},this.dataSourceChangeSave=e=>{var a;if(!e)return;const s=(0,i.Immutable)(e[0]),o=this.dsManager.getDataSource(s.dataSourceId),l=o&&o.getSchema(),n=null===(a=o)||void 0===a?void 0:a.getLayerDefinition(),r=["CreationDate","Creator","EditDate","Editor","GlobalID"],d=(null==l?void 0:l.fields)?Object.values(null==l?void 0:l.fields):[],c=(null==n?void 0:n.fields)||[];let h=d.filter((e=>!r.includes(e.jimuName))).map((e=>{const t=c.find((t=>t.name===e.jimuName)),i=null==t?void 0:t.editable;return Object.assign(Object.assign({},e),{editAuthority:i,editable:i})}));(null==h?void 0:h.length)>50&&(h=h.slice(0,50)),this.dsManager.createDataSourceByUseDataSource((0,i.Immutable)(e[0])).then((e=>{const a={id:this.getNewConfigId(e.id),name:e.getLabel(),useDataSource:s,allFields:d,tableFields:h,enableAttachements:!1,enableEdit:!1,allowCsv:!1,enableSearch:!1,searchFields:"",enableRefresh:!0,enableSelect:!0,selectMode:t.Single};let o;if(this.props.config.layersConfig[this.index]){const e=this.props.config.layersConfig.asMutable({deep:!0});e.splice(this.index,1,a),o=(0,i.Immutable)(e)}else o=this.props.config.layersConfig.concat([(0,i.Immutable)(a)]);this.dsHash[this.index]=s,this.updateDsHash(o);const l={id:this.props.id,config:this.props.config.set("layersConfig",o),useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(l)}))},this.onCloseLayerPanel=()=>{this.setState({showLayerPanel:!1}),this.index=0},this.getUniqueValues=(e=[],t=[])=>e.concat(t).filter((function(e,t,i){return i.indexOf(e)===t})),this.getUseDataSourcesByDsHash=()=>{const e={};Object.keys(this.dsHash).forEach((t=>{const a=this.dsHash[t].dataSourceId;let s;s=e[a]?(0,i.Immutable)({dataSourceId:this.dsHash[t].dataSourceId,mainDataSourceId:this.dsHash[t].mainDataSourceId,dataViewId:this.dsHash[t].dataViewId,rootDataSourceId:this.dsHash[t].rootDataSourceId,fields:this.getUniqueValues(e[a].fields,this.dsHash[t].fields)}):this.dsHash[t],e[a]=s}));const t=[];return Object.keys(e).forEach((i=>{t.push(e[i])})),t},this.removeLayer=e=>{this.index===e&&this.onCloseLayerPanel();const t=this.props.config.layersConfig.asMutable({deep:!0});t.splice(e,1);const i=this.props.config.set("layersConfig",t);delete this.dsHash[e],this.updateDsHash(t);const a={id:this.props.id,config:i,useDataSources:this.getUseDataSourcesByDsHash()};this.props.onSettingChange(a),this.index>e&&this.index--,h.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"removeLayerFlag",value:!0})},this.optionChangeSave=(e,t)=>{const i=this.props.config.layersConfig[this.index];if(i){const a=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},i),{[e]:t})),s={id:this.props.id,config:a};this.props.onSettingChange(s)}h.builderAppSync.publishChangeWidgetStatePropToApp({widgetId:this.props.id,propKey:"removeLayerFlag",value:!0})},this.multiOptionsChangeSave=e=>{const t=this.props.config.layersConfig[this.index];if(t){const i=this.props.config.setIn(["layersConfig",this.index.toString()],Object.assign(Object.assign({},t),e)),a={id:this.props.id,config:i};this.props.onSettingChange(a)}},this.getStyle=e=>i.css`
      .widget-setting-table {
        .filter-item {
          display: flex;
          padding: 0.5rem 0.75rem;
          margin-bottom: 0.25rem;
          line-height: 23px;
          cursor: pointer;
          background-color: ${e.colors.secondary};

          .filter-item-icon {
            width: 14px;
            margin-right: 0.5rem;
          }
          .filter-item-name {
            word-wrap: break-word;
          }
        }

        .filter-item-active {
          border-left: 2px solid ${e.colors.palette.primary[600]};
        }

        .arrange-style-container {
          .arrange_container {
            margin-top: 10px;
            display: flex;
            .jimu-btn {
              padding: 0;
              background: ${e.colors.palette.light[200]};
              &.active {
                border: 2px solid ${e.colors.palette.primary[600]};
              }
            }
          }
        }
        .table-blank-placeholder {
          .placeholder-icon {
            color: ${e.colors.palette.dark[200]};
          }
          & > div {
            top: 50%;
            transform: translateY(-50%);
            padding: 1rem;
          }
          p {
            font-size: ${i.polished.rem(14)};
            margin-top: ${i.polished.rem(16)};
            line-height: ${i.polished.rem(19)};
            color: ${e.colors.palette.dark[500]};
          }
        }

        .setting-ui-unit-tree, .setting-ui-unit-list {
          width: 100%;
          .tree-item {
            justify-content: space-between;
            align-items: center;
            font-size: ${i.polished.rem(13)};
            &.tree-item_level-1 {
            }
            .jimu-checkbox {
              margin-right: .5rem;
            }
          }
        }
        .setting-ui-unit-list-new {
          padding-top: ${i.polished.rem(8)};
        }
      }
    `,this.formatMessage=(e,t)=>{const i=Object.assign({},l,a.defaultMessages);return this.props.intl.formatMessage({id:e,defaultMessage:i[e]},t)},this.onShowLayerPanel=(e,t=!1)=>{const{showLayerPanel:i}=this.state;this.setSidePopperAnchor(e,t),e===this.index?this.setState({showLayerPanel:!i}):(this.setState({showLayerPanel:!0,refreshPanel:!this.state.refreshPanel}),this.index=e)},this.switchTableType=e=>{if(e!==this.props.config.arrangeType){const t={id:this.props.id,config:this.props.config.set("arrangeType",e)};this.props.onSettingChange(t)}},this.onItemUpdated=(e,t)=>{const{id:i,config:a}=this.props,s=e.map((e=>e.itemStateDetailContent)),o={id:i,config:a.set("layersConfig",s)};this.updateDsHash(s),this.onShowLayerPanel(t),this.props.onSettingChange(o)},this.onCreateDataSourceCreatedOrFailed=(e,t)=>{this.setState((i=>{const a=Object.assign({},i.dataSources);return a[e]=t,{dataSources:a}}))},this.isDataSourceAccessible=e=>{var t;const i=(null===(t=this.props.useDataSources)||void 0===t?void 0:t.filter((t=>e===t.dataSourceId)).length)>0;return null!==this.state.dataSources[e]&&i},this.setSidePopperAnchor=(e,t=!1)=>{let i;i=t?this.sidePopperTrigger.current.getElementsByClassName("add-table-btn")[0]:this.sidePopperTrigger.current.getElementsByClassName("jimu-tree-item__body")[e],this.setState({popperFocusNode:i})},this.index=0,this.dsManager=i.DataSourceManager.getInstance(),this.updateDsHash(this.props.config.layersConfig?this.props.config.layersConfig:[]),this.state={showLayerPanel:!1,refreshPanel:!1,dataSources:{},popperFocusNode:null}}getArrayMaxId(e){const t=e.map((e=>e.id.split("-").reverse()[0]));return t.length>0?Math.max.apply(null,t):0}render(){var t,o;const{showLayerPanel:l,popperFocusNode:n}=this.state,{theme:c,config:h,id:g}=this.props,p=this.formatMessage("newSheet"),D=h.layersConfig.length,S={isItemFocused:(e,t)=>{const{itemJsons:[i,a]}=t.props;return l&&a.indexOf(i)===this.index},overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:r.TreeItemActionType.RenderOverrideItem,children:[{name:r.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:r.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:r.TreeItemActionType.RenderOverrideItemBody,children:[{name:r.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:r.TreeItemActionType.RenderOverrideItemDragHandle},{name:r.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:r.TreeItemActionType.RenderOverrideItemTitle},{name:r.TreeItemActionType.RenderOverrideItemDetailToggle},{name:r.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,i.jsx)("div",{css:this.getStyle(c)},(0,i.jsx)("div",{className:"widget-setting-table"},null===(t=this.props.useDataSources)||void 0===t?void 0:t.map(((e,t)=>(0,i.jsx)(m,{key:t,useDataSource:e,onCreateDataSourceCreatedOrFailed:this.onCreateDataSourceCreatedOrFailed}))),(0,i.jsx)(s.SettingSection,{className:"p-0 m-0 "+(D>0?"":"border-0")},(0,i.jsx)("div",{ref:this.sidePopperTrigger},(0,i.jsx)(s.SettingSection,{className:"border-0"},(0,i.jsx)(s.SettingRow,null,(0,i.jsx)(a.Button,{className:"w-100 text-dark add-table-btn",type:"primary",onClick:()=>{this.onShowLayerPanel(D,!0)},"aria-describedby":"table-widget-empty"},(0,i.jsx)("div",{className:"w-100 px-2 text-truncate"},p)))),(0,i.jsx)(s.SettingSection,{className:"pt-0 border-0"},(0,i.jsx)("div",{className:"setting-ui-unit-list"},!!D&&(0,i.jsx)(r.List,Object.assign({size:"sm",className:"setting-ui-unit-list-exsiting",itemsJson:Array.from(h.layersConfig).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`,itemStateTitle:e.name,itemStateCommands:[{label:this.formatMessage("remove"),iconProps:()=>({icon:u(),size:12}),action:()=>{this.removeLayer(t)}}]}))),dndEnabled:!0,renderOverrideItemDetailToggle:(e,t)=>{var s,o;const{itemJsons:l}=t.props,[n]=l,r=null===(o=null===(s=null==n?void 0:n.itemStateDetailContent)||void 0===s?void 0:s.useDataSource)||void 0===o?void 0:o.dataSourceId;return this.isDataSourceAccessible(r)?"":(0,i.jsx)(a.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:this.formatMessage("dataSourceCreateError")})},onUpdateItem:(e,t)=>{const{itemJsons:i}=t.props,[a,s]=i;this.onItemUpdated(s,+a.itemKey)},onClickItemBody:(e,t)=>{const{itemJsons:[i]}=t.props;this.onShowLayerPanel(+i.itemKey)}},S)),D===this.index&&l&&(0,i.jsx)(r.List,Object.assign({size:"sm",className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map(((e,t)=>({itemStateDetailContent:e,itemKey:`${this.index}`,itemStateTitle:e.name,itemStateCommands:[]}))),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},S,{isItemFocused:()=>!0})))))),0===D&&(0,i.jsx)("div",{className:"w-100 text-center table-blank-placeholder"},(0,i.jsx)("div",{className:"position-absolute w-100"},(0,i.jsx)(b,{size:48,className:"placeholder-icon"}),(0,i.jsx)("p",{id:"table-widget-empty"},this.formatMessage("tableBlankStatus",{SheetString:p})))),D>0&&(0,i.jsx)(s.SettingSection,{className:"arrange-style-container",title:this.formatMessage("sheetStyle")},(0,i.jsx)(s.SettingRow,{className:"arrange_container"},(0,i.jsx)(a.Tooltip,{title:this.formatMessage("tabs"),placement:"bottom"},(0,i.jsx)(a.Button,{onClick:()=>this.switchTableType(e.Tabs),icon:!0,size:"sm",type:"tertiary",active:h.arrangeType===e.Tabs},(0,i.jsx)(a.Icon,{autoFlip:!0,width:109,height:70,icon:d(32253)}))),(0,i.jsx)(a.Tooltip,{title:this.formatMessage("dropdown"),placement:"bottom"},(0,i.jsx)(a.Button,{onClick:()=>this.switchTableType(e.Dropdown),className:"ml-2",icon:!0,size:"sm",type:"tertiary",active:h.arrangeType===e.Dropdown},(0,i.jsx)(a.Icon,{autoFlip:!0,width:109,height:70,icon:d(28676)}))))),(0,i.jsx)(s.SidePopper,{position:"right",title:this.formatMessage("layerConfig"),isOpen:l&&!i.urlUtils.getAppIdPageIdFromUrl().pageId,toggle:this.onCloseLayerPanel,trigger:null===(o=this.sidePopperTrigger)||void 0===o?void 0:o.current,backToFocusNode:n},(0,i.jsx)(I,Object.assign({},h.layersConfig.asMutable({deep:!0})[this.index],{intl:this.props.intl,theme:c,widgetId:g,dataSourceChange:this.dataSourceChangeSave,optionChange:this.optionChangeSave,multiOptionsChange:this.multiOptionsChangeSave,onClose:this.onCloseLayerPanel})))))}}M.mapExtraStateProps=(e,t)=>{var i,a;return{dsJsons:e.appStateInBuilder.appConfig.dataSources,activeTabId:e&&(null===(a=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.widgetsState[t.id])||void 0===a?void 0:a.activeTabId)}}})(),c})())}}}));