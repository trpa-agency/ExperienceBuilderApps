System.register(["jimu-core","jimu-layouts/layout-runtime","jimu-ui","jimu-core/react","jimu-arcgis","jimu-theme"],(function(e,o){var t={},n={},l={},r={},s={},i={};return{setters:[function(e){t.AppMode=e.AppMode,t.ClauseLogic=e.ClauseLogic,t.ClauseOperator=e.ClauseOperator,t.DataRecordSetChangeMessage=e.DataRecordSetChangeMessage,t.DataRecordsSelectionChangeMessage=e.DataRecordsSelectionChangeMessage,t.DataSourceComponent=e.DataSourceComponent,t.DataSourceFilterChangeMessage=e.DataSourceFilterChangeMessage,t.DataSourceManager=e.DataSourceManager,t.DataSourceStatus=e.DataSourceStatus,t.Immutable=e.Immutable,t.JimuFieldType=e.JimuFieldType,t.MessageManager=e.MessageManager,t.QueryScope=e.QueryScope,t.React=e.React,t.ReactRedux=e.ReactRedux,t.RecordSetChangeType=e.RecordSetChangeType,t.classNames=e.classNames,t.css=e.css,t.dataSourceUtils=e.dataSourceUtils,t.esri=e.esri,t.jsx=e.jsx,t.lodash=e.lodash,t.polished=e.polished},function(e){n.PageVisibilityContext=e.PageVisibilityContext,n.ViewVisibilityContext=e.ViewVisibilityContext},function(e){l.Button=e.Button,l.Checkbox=e.Checkbox,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.Icon=e.Icon,l.Link=e.Link,l.TextInput=e.TextInput,l.defaultMessages=e.defaultMessages,l.hooks=e.hooks},function(e){r.useEffect=e.useEffect},function(e){s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.useTheme=e.useTheme}],execute:function(){e((()=>{var e={20864:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13 6.133c0 .598-.28 1.46-.825 2.51-.53 1.02-1.247 2.102-1.981 3.102A45.718 45.718 0 018 14.492a48.01 48.01 0 01-2.194-2.747c-.734-1-1.451-2.081-1.98-3.102C3.28 7.593 3 6.731 3 6.133 3 3.277 5.26 1 8 1s5 2.277 5 5.133zm1 0c0 2.685-3.768 7.311-5.332 9.115C8.258 15.722 8 16 8 16s-.258-.279-.668-.752C5.768 13.444 2 8.819 2 6.133 2 2.746 4.686 0 8 0s6 2.746 6 6.133zM10 5.5a2 2 0 11-4 0 2 2 0 014 0zm1 0a3 3 0 11-6 0 3 3 0 016 0z" fill="#000"></path></svg>'},59788:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2.146 4.653a.485.485 0 01.708 0L8 10.24l5.146-5.587a.485.485 0 01.708 0 .538.538 0 010 .738l-5.5 5.956a.485.485 0 01-.708 0l-5.5-5.956a.538.538 0 010-.738z" fill="#000"></path></svg>'},96009:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13.854 11.347a.486.486 0 01-.708 0L8 5.76l-5.146 5.587a.485.485 0 01-.708 0 .538.538 0 010-.738l5.5-5.956a.485.485 0 01.708 0l5.5 5.956a.538.538 0 010 .738z" fill="#000"></path></svg>'},55339:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M8.745 8l6.1 6.1a.527.527 0 11-.745.746L8 8.746l-6.1 6.1a.527.527 0 11-.746-.746l6.1-6.1-6.1-6.1a.527.527 0 01.746-.746l6.1 6.1 6.1-6.1a.527.527 0 01.746.746L8.746 8z" fill="#000"></path></svg>'},30224:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 6.5a5.5 5.5 0 11-11 0 5.5 5.5 0 0111 0zm-1.27 4.936a6.5 6.5 0 11.707-.707l4.136 4.137a.5.5 0 11-.707.707l-4.137-4.137z" fill="#000"></path></svg>'},54357:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M6 6.5a.5.5 0 011 0v6a.5.5 0 01-1 0v-6zM9.5 6a.5.5 0 00-.5.5v6a.5.5 0 001 0v-6a.5.5 0 00-.5-.5z" fill="#000"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M11 0H5a1 1 0 00-1 1v2H.5a.5.5 0 000 1h1.6l.81 11.1a1 1 0 00.995.9h8.19a1 1 0 00.995-.9L13.9 4h1.6a.5.5 0 000-1H12V1a1 1 0 00-1-1zm0 3V1H5v2h6zm1.895 1h-9.79l.8 11h8.19l.8-11z" fill="#000"></path></svg>'},79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125L14.334 14H1.667L8 2.125zm-.882-.47a1 1 0 011.765 0l6.333 11.874A1 1 0 0114.334 15H1.667a1 1 0 01-.882-1.47L7.118 1.653zM8 4.874a.905.905 0 00-.9.995l.35 3.507a.552.552 0 001.1 0L8.9 5.87a.905.905 0 00-.9-.995zm1 7a1 1 0 11-2 0 1 1 0 012 0z" fill="#000"></path></svg>'},26826:e=>{"use strict";e.exports=s},48891:e=>{"use strict";e.exports=t},51315:e=>{"use strict";e.exports=r},74758:e=>{"use strict";e.exports=n},34796:e=>{"use strict";e.exports=i},30726:e=>{"use strict";e.exports=l}},o={};function a(t){var n=o[t];if(void 0!==n)return n.exports;var l=o[t]={exports:{}};return e[t](l,l.exports,a),l.exports}a.n=e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return a.d(o,{a:o}),o},a.d=(e,o)=>{for(var t in o)a.o(o,t)&&!a.o(e,t)&&Object.defineProperty(e,t,{enumerable:!0,get:o[t]})},a.o=(e,o)=>Object.prototype.hasOwnProperty.call(e,o),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.p="";var c={};return a.p=window.jimuConfig.baseUrl,(()=>{"use strict";a.r(c),a.d(c,{default:()=>Pe});var e,o,t,n,l=a(48891),r=a(74758);!function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(e||(e={})),function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(o||(o={})),function(e){e.Style1="Style1",e.Style2="Style2"}(t||(t={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(n||(n={}));var s=a(30726),i=a(51315);const u={_widgetLabel:"Search",findAddressOrPlace:"Find address or place",showResult:"Show search results for {searchText}",hideResult:"Hide search results for {searchText}",allSearchSources:"All search sources",useCurrentLocation:"Use current location",noResult:'No results found for "{searchText}"',couldNotRetrieve:"Could not retrieve current location.",recentSearches:"Recent searches",showMoreResult:"Show more results",clearAllHistories:"Clear all histories",clearHistorie:"Clear history",clearThisHistories:"Remove this history",clearRecentSearches:"Recent searches",searchIn:"Search in {value}",searchResults:"Search result"};var d=a(59788),v=a.n(d);const g=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)o.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(t[n[l]]=e[n[l]])}return t}(e,["className"]),n=(0,l.classNames)("jimu-icon-component",o);return l.React.createElement(s.Icon,Object.assign({className:n,icon:v()},t))};var m=a(96009),p=a.n(m);const h=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)o.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(t[n[l]]=e[n[l]])}return t}(e,["className"]),n=(0,l.classNames)("jimu-icon-component",o);return l.React.createElement(s.Icon,Object.assign({className:n,icon:p()},t))},{useRef:f,useState:S}=l.React,y=e=>{const o=s.hooks.useTranslate(u,s.defaultMessages),t=l.css`
    & {
      box-sizing: border-box;
      width: ${l.polished.rem(32)}
    }
    .setting-dropdown-button {
      border-radius: 0;
      svg {
        margin: 0 !important;
      }
    }
  `,[n,r]=S(!0),[a,c]=l.React.useState(!1),{className:d,datasourceConfig:v,onDatasourceConfigChange:m}=e,p=f(null);return(0,i.useEffect)((()=>{var e;const o=0===(null===(e=null==v?void 0:v.filter((e=>!(null==e?void 0:e.enable))))||void 0===e?void 0:e.length);r(o)}),[v]),(0,l.jsx)("div",{className:`${d||""}`,css:t},(0,l.jsx)(s.Dropdown,{className:"w-100 h-100",toggle:e=>{var o;const t=null==e?void 0:e.target;if(null===(o=null==p?void 0:p.current)||void 0===o?void 0:o.contains(t))return!1;c(!a)},isOpen:a},(0,l.jsx)(s.DropdownButton,{className:"h-100 setting-dropdown-button",arrow:!1,icon:!0,title:o("searchIn",{value:""})},!a&&(0,l.jsx)(g,{size:16,className:"mr-1 d-inline-block",autoFlip:!0}),a&&(0,l.jsx)(h,{size:16,className:"mr-1 d-inline-block",autoFlip:!0})),(0,l.jsx)(s.DropdownMenu,{trapFocus:!1,autoFocus:!1,style:{maxHeight:"auto"}},(0,l.jsx)("div",{ref:p},(0,l.jsx)(s.DropdownItem,{onClick:()=>{const e=null==v?void 0:v.map((e=>{var o;return null===(o=e.setIn(["enable"],!0))||void 0===o?void 0:o.asMutable({deep:!0})}));m(e)},disabled:n},(0,l.jsx)(s.Checkbox,{checked:n,disabled:n,className:"mr-2"}),o("all")),(0,l.jsx)(s.DropdownItem,{divider:!0}),null==v?void 0:v.map(((e,o)=>{var t;const n=1===(null===(t=null==v?void 0:v.filter((e=>null==e?void 0:e.enable)))||void 0===t?void 0:t.length)&&(null==e?void 0:e.enable);return(0,l.jsx)(s.DropdownItem,{key:`${null==e?void 0:e.label}${o}`,disabled:n,onClick:()=>{((e,o)=>{var t;const n=null===(t=v)||void 0===t?void 0:t.setIn([o,"enable"],e);m(n)})(!(null==e?void 0:e.enable),o)}},(0,l.jsx)(s.Checkbox,{checked:null==e?void 0:e.enable,disabled:n,className:"mr-2"}),null==e?void 0:e.label)}))))))};var x=a(26826);const I="objectid",b="address",w={alias:"OBJECTID",type:"oid",name:I},j={alias:"ADDRESS",type:"string",name:b},R=Object.assign(Object.assign({},j),{jimuName:b}),O=(e,o)=>V(null==o?void 0:o.outputDataSourceId)?D(o,e):Promise.resolve({}),D=(e,o)=>P(null==e?void 0:e.geocodeURL,o,null==e?void 0:e.maxSuggestions).then((t=>{let n=[];t.forEach(((t,l)=>{const r=t.text,s=new RegExp(`(${o})`,"gi");if(r&&!G(n,r)&&r.match(s)){const l={suggestionHtml:_(r,o),suggestion:r,configId:null==e?void 0:e.configId,magicKey:null==t?void 0:t.magicKey};n.push(l)}})),n=E(n,"suggestion");const l={suggestionItem:n.splice(0,e.maxSuggestions),layer:null==e?void 0:e.label,icon:null==e?void 0:e.icon};return Promise.resolve(l)})).catch((e=>Promise.reject(e))),N=(e,o,t,n)=>{if(V(null==t?void 0:t.outputDataSourceId))return B(F(t.outputDataSourceId),l.DataSourceStatus.NotReady),C({address:e,maxResultNumber:o,searchResultView:n,geocodeItem:t})},C=e=>{const{address:o,maxResultNumber:t,geocodeItem:n}=e,{outputDataSourceId:r,singleLineFieldName:s}=n,i=F(r);return M(n,o,t,s).then((e=>(0,x.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer","esri/Graphic"]).then((t=>{const[n,s]=t,a=null==e?void 0:e.filter((e=>null==e?void 0:e.address));let c;const u=null==a?void 0:a.map(((e,o)=>{const t=e.attributes;return t.address=e.address,t.objectid=o,c=e.extent,new s({attributes:t,geometry:e.location})})),d=new n({id:`${r}_layer`,fields:[w,j],objectIdField:I,geometryType:"point",source:u,fullExtent:c});i.layer=d;const v=o?l.DataSourceStatus.Unloaded:l.DataSourceStatus.NotReady;return B(i,v),Promise.resolve(l.DataSourceStatus.Unloaded)})))).catch((e=>Promise.reject(e)))},M=(e,o,t,n)=>{const{geocodeURL:r,magicKey:s}=e;return(0,x.loadArcGISJSAPIModules)(["esri/tasks/Locator"]).then((e=>{const[i]=e,a=new i({url:r}),c=n||"SingleLine";let u=(0,l.Immutable)({maxSuggestions:t});return u=u.setIn([c],o),s&&(u=u.set("magicKey",s)),a.addressToLocations({address:null==u?void 0:u.asMutable({deep:!0})},{query:{}}).then((e=>(e=e.sort(((e,o)=>o.score-e.score))).filter((e=>e.location))),(e=>(console.error(e.message),[])))}))},P=(e,o,t)=>(0,x.loadArcGISJSAPIModules)(["esri/tasks/Locator"]).then((n=>{const[l]=n;return new l({url:e}).suggestLocations({text:o,maxSuggestions:t},{query:{}}).then((e=>e||[]),(e=>(console.error(e.message),[])))})),T=(e,o,t,n=!1)=>{const r=null==e?void 0:e.outputDataSourceId,s=F(null==e?void 0:e.outputDataSourceId),i={where:"1=1",pageSize:o,page:1,returnGeometry:!0};return null==s?void 0:s.load(i,{widgetId:t}).then((o=>(n&&k(r,t,[],l.RecordSetChangeType.Remove),setTimeout((()=>{n&&k(r,t,o)}),100),Promise.resolve({records:o,configId:e.configId,dsId:r,isGeocodeRecords:!0}))))},k=(e,o,t,n=l.RecordSetChangeType.Update)=>{const r=F(e),s=new l.DataRecordSetChangeMessage(o,e,n,{records:t,dataSource:r});l.MessageManager.getInstance().publishMessage(s)},L=(o,t,n,l=!1)=>{const r=[];for(const s in o){const i=o[s];let a;a=i.searchServiceType===e.FeatureService?Q(i,t,n):T(i,t,n,l),r.push(a)}return Promise.all(r)},F=e=>e?l.DataSourceManager.getInstance().getDataSource(e):null,E=(e,o)=>{const t=e[0]?[e[0]]:[];for(let n=1;n<e.length;n++){const l=e[n];let r=!1;for(let e=0;e<t.length;e++)if(l[o]===t[e][o]){r=!0;break}r||t.push(l)}return t},$=e=>{const o=`${e}_recent_searches`;let t=localStorage.getItem(o);return t&&(t=unescape(t)),t?null==t?void 0:t.split("/@/"):[]},z=(e,o)=>{var t,n,l;return null===(l=null===(n=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.datasourceConfig)||void 0===n?void 0:n.filter((e=>e.configId===o)))||void 0===l?void 0:l[0]},A=e=>{let o=0;for(const t in e)o++;return o};function G(e,o){return e.filter((e=>o===(null==e?void 0:e.suggestion))).length>0}function _(e,o){if(!o)return e;const t=new RegExp(`(${o})`,"gi"),n=new RegExp(`(${o})`,"gi");return e.match(t)?e.replace(n,"<strong >$1</strong>"):e}function B(e,o){e.setStatus(o),e.setCountStatus(o)}function V(e){return!!e&&!!F(e)}function U(e){return e?[-32,3]:[0,3]}var H=function(e,o,t,n){return new(t||(t=Promise))((function(l,r){function s(e){try{a(n.next(e))}catch(e){r(e)}}function i(e){try{a(n.throw(e))}catch(e){r(e)}}function a(e){var o;e.done?l(e.value):(o=e.value,o instanceof t?o:new t((function(e){e(o)}))).then(s,i)}a((n=n.apply(e,o||[])).next())}))};function J(e,o,t){var n,r;return H(this,void 0,void 0,(function*(){const s=(null==o?void 0:o.datasourceConfig)||[];if(!V(null===(n=null==t?void 0:t.useDataSource)||void 0===n?void 0:n.dataSourceId))return Promise.resolve({});const i=(null==t?void 0:t.searchFields)||[],a=null===(r=null==s?void 0:s.filter((e=>(null==e?void 0:e.configId)===t.configId)))||void 0===r?void 0:r[0];return function(e,o,t,n,r){var s;return H(this,void 0,void 0,(function*(){const{label:i,icon:a,configId:c}=t,u=null===(s=null==o?void 0:o.useDataSource)||void 0===s?void 0:s.dataSourceId,d=F(u),v=null==o?void 0:o.SQL,g={outFields:n.map((e=>e.name)),returnDistinctValues:!0,returnGeometry:!1,orderByFields:null};((null==v?void 0:v.sql)||"string"==typeof(null==v?void 0:v.sql))&&(g.where=null==v?void 0:v.sql);const m=new RegExp(`(${e})`,"gi");return function(e,o){return H(this,void 0,void 0,(function*(){return o?yield o.query(e,{scope:l.QueryScope.InConfigView}).then((e=>H(this,void 0,void 0,(function*(){return yield function(e,o){return H(this,void 0,void 0,(function*(){return yield Promise.resolve((null==o?void 0:o.records)||[])}))}(0,e)})))):yield Promise.resolve([])}))}(g,d).then((o=>H(this,void 0,void 0,(function*(){let t=[];n.forEach((n=>{o.forEach((o=>{var l;const r=(null===(l=null==o?void 0:o.feature)||void 0===l?void 0:l.attributes[null==n?void 0:n.name])+"";if(r&&!G(t,r)&&r.match(m)){const o={suggestionHtml:_(r,e),suggestion:r,configId:c,isFromSuggestion:!0};t.push(o)}}))})),t=E(t,"suggestion");const l={suggestionItem:t.splice(0,r),layer:i,icon:a};return Promise.resolve(l)})))).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(e,t,a,i,null==o?void 0:o.maxSuggestions)}))}function q(e,o,t,n){if(o){const r=[];o.forEach((o=>{if(o.type===l.JimuFieldType.Number&&!Number(e))return!1;const t=function(e,o){let t;return e===l.JimuFieldType.Number?t=l.ClauseOperator.NumberOperatorIs:e===l.JimuFieldType.String&&(t=o?l.ClauseOperator.StringOperatorIs:l.ClauseOperator.StringOperatorContains),t}(o.type,n),s=o.type===l.JimuFieldType.Number?Number(e):e,i=l.dataSourceUtils.createSQLClause(null==o?void 0:o.name,t,s);r.push(i)}));const s=l.dataSourceUtils.createSQLExpression(l.ClauseLogic.Or,r);return l.dataSourceUtils.getArcGISSQL(s,t)}}function K(e,o,t){var n;const r=null===(n=null==e?void 0:e.useDataSource)||void 0===n?void 0:n.dataSourceId,s=F(r),i=null==e?void 0:e.SQL,a=t?(null==i?void 0:i.sql)||"1=0":"1=1",c=(0,l.Immutable)({outFields:["*"],where:a,returnGeometry:!0});s&&s.updateQueryParams(c,o)}const Q=(e,o,t)=>{var n,l;const r=null===(n=null==e?void 0:e.useDataSource)||void 0===n?void 0:n.dataSourceId;if(!V(r))return Promise.resolve({});const s=F(r),i={where:(null===(l=null==e?void 0:e.SQL)||void 0===l?void 0:l.sql)||"1=0",pageSize:o,page:1,returnGeometry:!0};return null==s?void 0:s.load(i,{widgetId:t}).then((o=>Promise.resolve({records:o,configId:e.configId,dsId:r,isGeocodeRecords:!1})))};var W=a(54357),X=a.n(W);const Y=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)o.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(t[n[l]]=e[n[l]])}return t}(e,["className"]),n=(0,l.classNames)("jimu-icon-component",o);return l.React.createElement(s.Icon,Object.assign({className:n,icon:X()},t))};var Z=a(20864),ee=a.n(Z);const oe=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)o.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(t[n[l]]=e[n[l]])}return t}(e,["className"]),n=(0,l.classNames)("jimu-icon-component",o);return l.React.createElement(s.Icon,Object.assign({className:n,icon:ee()},t))};var te=a(79964),ne=a.n(te);const le=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)o.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(t[n[l]]=e[n[l]])}return t}(e,["className"]),n=(0,l.classNames)("jimu-icon-component",o);return l.React.createElement(s.Icon,Object.assign({className:n,icon:ne()},t))},{useState:re}=l.React,se=o=>{const t=s.hooks.useTranslate(u,s.defaultMessages),{serviceList:n,onLocationChange:r}=o,[i,a]=re(!1),[c,d]=l.React.useState(null);l.React.useEffect((()=>{v()}),[n]);const v=()=>{for(const o in n){const t=n[o];if(t.searchServiceType===e.GeocodeService){d(t);break}}},g=e=>{const o=`${e.coords.longitude},${e.coords.latitude}`;c?((e,o)=>o?(0,x.loadArcGISJSAPIModules)(["esri/tasks/Locator"]).then((t=>{const[n]=t,l=new n({url:e});return(e=>{const o=e&&e.coords;return o?(0,x.loadArcGISJSAPIModules)(["esri/geometry/Point"]).then((e=>{const[t]=e;return new t({longitude:o.longitude,latitude:o.latitude,z:o.altitude||null,spatialReference:{wkid:4326}})})):Promise.resolve(null)})(o).then((e=>l.locationToAddress({location:e},{query:{}}).then((e=>Promise.resolve(e.address)),(e=>(console.error(e.message),[])))))})):Promise.resolve(null))(null==c?void 0:c.geocodeURL,e).then((e=>{r(e)})):r(o)},m=()=>{a(!0)};return(0,l.jsx)("div",null,!i&&(0,l.jsx)(s.DropdownItem,{onClick:()=>{var e,o;e=g,o=m,navigator.geolocation?navigator.geolocation.getCurrentPosition(e,o):o&&o()}},(0,l.jsx)(oe,null),t("useCurrentLocation")),i&&(0,l.jsx)(s.DropdownItem,null,(0,l.jsx)(le,null),t("couldNotRetrieve")))};var ie=a(34796);const ae=(e,o)=>{var t,n,r,s,i,a,c,u,d,v,g,m,p,h,f,S,y,x;return l.css`
    & {
      max-height: ${l.polished.rem(300)};
      width: ${l.polished.rem(null===(t=null==o?void 0:o.current)||void 0===t?void 0:t.clientWidth)};
      overflow: auto;
      padding-top: 0;
      padding-bottom: 0;
      visibility: unset !important;
    }
    &.result-list-con .dropdown-item {
      text-overflow: ellipsis;
      white-space: pre-wrap;
    }
    &.result-list-con .dropdown-item:disabled {
      color: ${null===(s=null===(r=null===(n=null==e?void 0:e.colors)||void 0===n?void 0:n.palette)||void 0===r?void 0:r.secondary)||void 0===s?void 0:s[800]};
      background-color: ${null===(c=null===(a=null===(i=null==e?void 0:e.colors)||void 0===i?void 0:i.palette)||void 0===a?void 0:a.light)||void 0===c?void 0:c[200]};
      /* color: ${null===(u=null==e?void 0:e.colors)||void 0===u?void 0:u.black};
      background-color: ${null===(g=null===(v=null===(d=null==e?void 0:e.colors)||void 0===d?void 0:d.palette)||void 0===v?void 0:v.light)||void 0===g?void 0:g[100]}; */
    }
    &.result-list-con .dropdown-item:hover, &.result-list-con .dropdown-item:focus {
      color: ${null===(m=null==e?void 0:e.colors)||void 0===m?void 0:m.black};
      background-color: ${null===(f=null===(h=null===(p=null==e?void 0:e.colors)||void 0===p?void 0:p.palette)||void 0===h?void 0:h.light)||void 0===f?void 0:f[100]};
    }
    &.result-list-con .dropdown-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con .dropdown-item.active {
      background: ${null===(S=null==e?void 0:e.colors)||void 0===S?void 0:S.primary};
      color: ${null===(y=null==e?void 0:e.colors)||void 0===y?void 0:y.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:focus {
      background-color: ${null===(x=null==e?void 0:e.colors)||void 0===x?void 0:x.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
  `},{useRef:ce}=l.React,ue=new(0,l.esri.Sanitizer),de=e=>{const o=s.hooks.useTranslate(u,s.defaultMessages),{isRecentSearches:t,className:n,reference:r,searchSuggestion:i,isOpen:a,searchText:c,canUseOutoutDsLength:d,serviceList:v,isShowCurrentLocation:g,config:m,toggel:p,onRecordItemClick:h,clearSearches:f,setSuggestionFirstItem:S}=e,y=(0,ie.useTheme)(),x=ce(!1),I=(e,o)=>{0!==e||x.current||(S(o),x.current=!0)},b=(null==m?void 0:m.datasourceConfig)||[];return(0,l.jsx)("div",null,(0,l.jsx)(s.Dropdown,{className:"w-100",size:"lg",isOpen:a,toggle:p},(0,l.jsx)(s.DropdownButton,{className:"sr-only search-dropdown-button",style:{height:0,padding:0}}),(0,l.jsx)(s.DropdownMenu,{className:(0,l.classNames)("result-list-con",n),offset:U(b.length>1),trapFocus:!1,autoFocus:!1,css:ae(y,r),style:{maxHeight:"auto"}},!c&&g&&(0,l.jsx)(se,{serviceList:v,isShowCurrentLocation:!0,onLocationChange:h}),(()=>{let e=[];return i.forEach((o=>{const t=(null==o?void 0:o.suggestionItem)||[];e=e.concat(t)})),c&&0===e.length})()&&(0,l.jsx)(s.DropdownItem,{className:"text-center",disabled:!0,title:o("noResult",{searchText:c})},o("noResult",{searchText:c})),(x.current=null,null==i?void 0:i.map(((e,o)=>{var t,n,r;const a=(null==i?void 0:i.length)>1&&(null===(t=null==e?void 0:e.suggestionItem)||void 0===t?void 0:t.length)>0;return(0,l.jsx)("div",{key:`${null==e?void 0:e.layer}-${o}`},a&&(0,l.jsx)(s.DropdownItem,{disabled:!0,title:null==e?void 0:e.layer},(null==e?void 0:e.icon)&&(0,l.jsx)(s.Icon,{className:"mr-2",color:null===(n=null==y?void 0:y.colors)||void 0===n?void 0:n.primary,size:16,icon:null===(r=null==e?void 0:e.icon)||void 0===r?void 0:r.svg}),null==e?void 0:e.layer),(e=>{const o=null==e?void 0:e.suggestionItem,t=null==e?void 0:e.icon;return null==o?void 0:o.map(((o,n)=>{var r;const i=ue.sanitize(o.suggestionHtml),a={configId:null==o?void 0:o.configId,isFromSuggestion:null==o?void 0:o.isFromSuggestion,magicKey:null==o?void 0:o.magicKey};return(0,l.jsx)(s.DropdownItem,{className:"d-flex align-items-center",key:`${null==e?void 0:e.layer}${n}`,title:o.suggestion,onClick:()=>{((e,o)=>{const{configId:t,isFromSuggestion:n,magicKey:l}=o||{};t&&(n||l)?h(e,o):h(e)})(o.suggestion,a)},ref:e=>{I(n,e)}},t&&1===d&&(0,l.jsx)(s.Icon,{className:"mr-2",color:null===(r=null==y?void 0:y.colors)||void 0===r?void 0:r.primary,size:16,icon:null==t?void 0:t.svg}),(0,l.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:i}}))}))})(e))}))),t&&(0,l.jsx)(s.DropdownItem,{divider:!0}),t&&(0,l.jsx)(s.DropdownItem,{title:o("clearRecentSearches"),type:"secondary",onClick:f},(0,l.jsx)(Y,null),o("clearRecentSearches")))))},{useEffect:ve,useRef:ge}=l.React,me=o=>{const t=s.hooks.useTranslate(u),{reference:n,searchText:r,id:i,config:a,serviceList:c,isOpentResultListDefault:d,setResultFirstItem:v}=o,{resultMaxNumber:m}=a,p=ge([]),f=ge(!1),S=ge(null),y=ge(!1);let x={};const I=(0,ie.useTheme)(),[b,w]=l.React.useState((0,l.Immutable)({})),[j,O]=l.React.useState({}),[D,N]=l.React.useState(null),[C,M]=l.React.useState(d),[P,T]=l.React.useState(!1);ve((()=>{k()}),[c]),ve((()=>{p.current=[]}),[r]);const k=()=>{f.current=!1;const e=L(null==c?void 0:c.asMutable({deep:!0}),m,i);Promise.all([e]).then((e=>{f.current=!0;let o=b||(0,l.Immutable)({}),t=[];null==e||e.forEach((e=>{t=t.concat(e)}));const n={};t.forEach((e=>{const{records:t,configId:l,dsId:r,isGeocodeRecords:s}=e;n[l]=t;const i=J(t,l,r,s);o=o.setIn([l],i)})),O(n),w(o),Q(),$()}))},E=(e,o)=>{0!==e||y.current||(v(o),y.current=!0)},$=()=>{var o;if(W())return;const t=[];for(const n in c){const l=c[n],r=(null==l?void 0:l.searchServiceType)===e.GeocodeService?null==l?void 0:l.outputDataSourceId:null===(o=null==l?void 0:l.useDataSource)||void 0===o?void 0:o.dataSourceId,s=G(r,n);s&&t.push(s)}const n=_(t,null==p?void 0:p.current);p.current=t,n&&n[0]?N(n[0]):N(null)},G=(e,o)=>{var t;const n=F(e).getSelectedRecords(),l=null===(t=null==n?void 0:n[0])||void 0===t?void 0:t.getId();return n&&l?K(o,l):null},_=(e,o)=>(null==e?void 0:e.length)>(null==o?void 0:o.length)?e.concat(o).filter((t=>!e.includes(t)||!o.includes(t)))||[]:e||[],B=e=>{const{isActive:o,recordId:t,dsId:n,configId:r}=e,s=F(n),a=o?[]:H(r,t);l.MessageManager.getInstance().publishMessage(new l.DataRecordsSelectionChangeMessage(i,a)),t&&(o?s.selectRecordsByIds([]):s.selectRecordsByIds([t]),!o&&V(r))},V=e=>{var o,t;for(const n in b)if(e!==n){const e=null===(t=null===(o=b[n])||void 0===o?void 0:o[0])||void 0===t?void 0:t.outputDsId,l=F(e);l&&l.selectRecordsByIds([])}},H=(e,o)=>{const t=(null==j?void 0:j[e])||[];return(null==t?void 0:t.filter((e=>(null==e?void 0:e.getId())===o)))||[]},J=(e,o,t,n)=>{var l;const r=(null===(l=null==c?void 0:c[o])||void 0===l?void 0:l.displayFields)||[],s=n?[R]:r,i=[];return null==e||e.forEach((e=>{const n=[];s.forEach((o=>{const t=e.getFieldValue(o.jimuName);t&&n.push(t)}));const l={value:n,configId:o,outputDsId:t,recordId:null==e?void 0:e.getId()};i.push(l),q(l)})),i},q=e=>{!(null==x?void 0:x.recordId)&&e.recordId&&(x=e)},K=(e,o)=>`${e}_${o}`,Q=()=>{if(!(null==a?void 0:a.isAutoSelectFirstResult)||!(null==x?void 0:x.recordId)||P)return;const{configId:e,recordId:o,outputDsId:t}=x,n=K(e,o);B({isActive:!1,key:n,recordId:o,dsId:t,configId:e}),T(!0)},W=()=>{var e;let o=0;for(const t in b)o+=(null===(e=null==b?void 0:b[t])||void 0===e?void 0:e.length)||0;return 0===o&&f.current};return(0,l.jsx)("div",null,(0,l.jsx)(s.Dropdown,{className:"w-100",size:"lg",isOpen:!0,toggle:e=>{var o;const t=null==e?void 0:e.target;if(null===(o=null==S?void 0:S.current)||void 0===o?void 0:o.contains(t))return!1;W()||M(!1)},"aria-expanded":!0},(0,l.jsx)(s.DropdownButton,{className:"sr-only search-dropdown-button",style:{height:0,padding:0}}),(0,l.jsx)(s.DropdownMenu,{className:"result-list-con",offset:U(A(a.datasourceConfig)>1),trapFocus:!1,autoFocus:!1,css:ae(I,n),style:{maxHeight:"auto"}},(0,l.jsx)("div",{ref:S},!W()&&(0,l.jsx)(s.DropdownItem,{className:"d-flex align-items-center show-result-button",onClick:()=>{M(!C)},title:t("searchResults")},(0,l.jsx)("div",{className:"flex-grow-1 font-weight-bold"},t("searchResults")),!C&&r?(0,l.jsx)(g,null):(0,l.jsx)(h,null)),C&&(0,l.jsx)("div",null,!W()&&(0,l.jsx)(s.DropdownItem,{divider:!0}),W()&&(0,l.jsx)(s.DropdownItem,{className:"text-center",disabled:!0,title:t("noResult",{searchText:r})},t("noResult",{searchText:r})),!W()&&(()=>{var e,o;const t=[];y.current=null;for(const r in b){const i=null===(e=null==b?void 0:b.asMutable({deep:!0}))||void 0===e?void 0:e[r],u=z(a,r),d=null==u?void 0:u.label,v=null==u?void 0:u.icon,g=A(c),m=(0,l.jsx)("div",{key:`${r}_${d}_con`},i.length>0&&(0,l.jsx)("div",null,g>1&&(0,l.jsx)(s.DropdownItem,{disabled:!0,key:`${r}_${d}`,title:d},v&&(0,l.jsx)(s.Icon,{className:"mr-2",color:null===(o=null==I?void 0:I.colors)||void 0===o?void 0:o.primary,size:16,icon:null==v?void 0:v.svg}),d),null==(n=i)?void 0:n.map(((e,o)=>{var t,n;const{configId:r,value:i,recordId:u,outputDsId:d}=e,v=K(r,u),g=D===v,m=z(a,r),p=null==m?void 0:m.icon,h=g?null===(t=null==I?void 0:I.colors)||void 0===t?void 0:t.white:null===(n=null==I?void 0:I.colors)||void 0===n?void 0:n.primary,f=A(c);return(0,l.jsx)(s.DropdownItem,{className:"d-flex align-items-center",key:v,active:g,title:i.join(", "),ref:e=>{E(o,e)},onClick:()=>{B({isActive:g,key:v,recordId:u,dsId:d,configId:r})}},p&&1===f&&(0,l.jsx)(s.Icon,{className:"mr-2",color:h,size:16,icon:null==p?void 0:p.svg}),(0,l.jsx)("div",null,i.join(", ")))}))));t.push(m)}var n;return t})())))))};var pe=a(30224),he=a.n(pe);const fe=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)o.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(t[n[l]]=e[n[l]])}return t}(e,["className"]),n=(0,l.classNames)("jimu-icon-component",o);return l.React.createElement(s.Icon,Object.assign({className:n,icon:he()},t))};var Se=a(55339),ye=a.n(Se);const xe=e=>{const{className:o}=e,t=function(e,o){var t={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&o.indexOf(n)<0&&(t[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)o.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(t[n[l]]=e[n[l]])}return t}(e,["className"]),n=(0,l.classNames)("jimu-icon-component",o);return l.React.createElement(s.Icon,Object.assign({className:n,icon:ye()},t))},{useSelector:Ie}=l.ReactRedux,{useState:be,useEffect:we,useRef:je,useMemo:Re}=l.React,Oe=n=>{var r,i,a,c,d,v;const g=s.hooks.useTranslate(u,s.defaultMessages),m=(0,ie.useTheme)(),p=Ie((e=>null==e?void 0:e.queryObject)),h=Ie((e=>{var o;return null===(o=null==e?void 0:e.appRuntimeInfo)||void 0===o?void 0:o.appMode})),f=je((e=>{})),S=je(null),y=je(null),x=je(null),I=je(!1),b=je(null),{config:w,className:j,reference:R,id:D,datasourceConfig:C,isShowSearchInput:M,isInCurrentView:P,isWidgetInCurrentPage:T,onShowSearchInputChange:E}=n,{isShowRecentSearches:z,recentSearchesMaxNumber:G,linkParam:_,searchResultView:U,resultMaxNumber:H,arrangementStyle:Q}=w,[W,X]=be(null),[Y,Z]=be(!1),[ee,oe]=be(!1),[te,ne]=be(!1),[le,re]=be({}),[se,ae]=be({}),[ce,ue]=be([]),[ve,ge]=be(!1),[pe,he]=be(!1),Se=l.css`
    .input-wrapper {
      height: 100% !important;
    }
    .loading-con {
      @keyframes loading {
        0% {transform: rotate(0deg); };
        100% {transform: rotate(360deg)};
      }
      width: ${l.polished.rem(16)};
      height: ${l.polished.rem(16)};
      min-width: ${l.polished.rem(16)};
      border: 2px solid ${null===(a=null===(i=null===(r=null==m?void 0:m.colors)||void 0===r?void 0:r.palette)||void 0===i?void 0:i.secondary)||void 0===a?void 0:a[300]};
      border-radius: 50%;
      border-top: 2px solid ${null===(v=null===(d=null===(c=null==m?void 0:m.colors)||void 0===c?void 0:c.palette)||void 0===d?void 0:d.primary)||void 0===v?void 0:v[500]};
      box-sizing: border-box;
      animation:loading 2s infinite linear;
      box-sizing: border-box;
    }
    .search-button {
      width: ${l.polished.rem(32)};
      border-radius: 0;
    }
    .search-input-con input{
      width: 100%;
    }
    .search-link-con {
      width: 0;
      height: 0;
      overflow: hidden;
    }
  `;we((()=>{Ae()}),[C]),we((()=>{I.current&&P&&T?(he(!1),l.lodash.defer((()=>{Oe(!0)}))):he(!0),P&&T||ge(!1)}),[P,T]),we((()=>{ve&&h===l.AppMode.Design&&ge(!1)}),[h]),we((()=>{f.current=l.lodash.debounce((o=>{const t=((o,t,n)=>{const l=[];for(const r in t){const s=t[r];let i;i=s.searchServiceType===e.FeatureService?J(o,n,s):O(o,s),l.push(i)}return Promise.all(l)})(o,se,w);Promise.all([t]).then((e=>{const o=null==e?void 0:e[0];Z(!1),o&&ue(o),oe(!0)})).catch((e=>{Z(!1)}))}),400)}),[se,w]);const ye=()=>{var o,t;for(const n in se)if((null===(o=se[n])||void 0===o?void 0:o.searchServiceType)===e.GeocodeService){const e=null===(t=se[n])||void 0===t?void 0:t.outputDataSourceId,o=F(e);o.selectRecordsByIds([]),B(o,l.DataSourceStatus.NotReady),k(e,D,[],l.RecordSetChangeType.Remove)}},Oe=e=>{I.current=e,e||he(!0),ge(e)},De=()=>{let e=!0;if(!b.current)return e;const o=b.current;for(const t in o){const n=o[t];if(e=!((null==n?void 0:n.magicKey)||(null==n?void 0:n.isFromSuggestion)),!e)break}return e},Ne=(t,n=!1)=>{ve&&!n||(Le(t),oe(!1),(t=>{const{serviceList:n,searchText:l,searchResultView:r,id:s}=t,i=[];for(const t in n){const a=n[t],{searchServiceType:c,resultMaxNumber:u}=a;if(c===e.FeatureService)K(a,s,l);else if(c===e.GeocodeService){const e=r===o.ResultPanel?u:null,t=N(l,e,a,r);i.push(t)}}return Promise.all(i)})({serviceList:b.current,searchText:t,searchResultView:U,id:D}).then((e=>{Ce(),t&&Me(t)})))},Ce=()=>{var o;const t=b.current;for(const n in t){const r=t[n];let s;(null==r?void 0:r.searchServiceType)===e.FeatureService?s=null===(o=null==r?void 0:r.useDataSource)||void 0===o?void 0:o.dataSourceId:(null==r?void 0:r.searchServiceType)===e.GeocodeService&&(s=null==r?void 0:r.outputDataSourceId),l.MessageManager.getInstance().publishMessage(new l.DataSourceFilterChangeMessage(D,s))}},Me=e=>{U===o.OtherWidgets?(Ee(),e&&(ke()?Fe():Pe())):Te()},Pe=()=>{const e=L(b.current,H,D);Promise.all([e]).then((e=>{let o=[],t=[];null==e||e.forEach((e=>{o=o.concat(e)})),o.forEach((e=>{const o=(null==e?void 0:e.records)||[];t=t.concat(o)})),(null==t?void 0:t.length)>0?Fe():Te()}))},Te=()=>{L(b.current,H,D,!0),Oe(!0)},ke=()=>{let e=[];return ce.forEach((o=>{e=e.concat(null==o?void 0:o.suggestionItem)})),e.length>0},Le=e=>{(e=>{const{searchText:o,id:t,recentSearchesMaxNumber:n,isShowRecentSearches:l}=e,r=`${t}_recent_searches`;if(!l||!o)return!1;let s=$(t);s.includes(o)||(s.unshift(o),s=s.splice(0,n||10),localStorage.setItem(r,escape(s.join("/@/"))))})({searchText:e,id:D,recentSearchesMaxNumber:G,isShowRecentSearches:z})},Fe=()=>{var e;if(!(null==S?void 0:S.current))return!1;null===(e=null==S?void 0:S.current)||void 0===e||e.click()},Ee=()=>{const e=U===o.ResultPanel?H:null,t=L(b.current,e,D,!0);Promise.all([t])},$e=Re((()=>(e=>{let o,t;return(null==e?void 0:e.linkType)&&(o=null==e?void 0:e.openType,t={linkType:null==e?void 0:e.linkType},t.value=null==e?void 0:e.value),{linkTo:t,target:o}})(_)),[_]),ze=(e,o)=>{te&&ne(!1),ue([]),X(e),Be(e,o)},Ae=()=>{var o;let t=(0,l.Immutable)({});null===(o=null==C?void 0:C.asMutable({deep:!0}))||void 0===o||o.forEach((o=>{if(!(null==o?void 0:o.enable))return!1;const{configId:n}=o;let l;l=(null==o?void 0:o.searchServiceType)===e.GeocodeService?_e(o):Ge(o),t=t.setIn([n],l)})),ae(null==t?void 0:t.asMutable({deep:!0}))},Ge=o=>{if(!(null==o?void 0:o.enable)||(null==o?void 0:o.searchServiceType)===e.GeocodeService)return!1;const{configId:t,useDataSource:n,displayFields:l,searchFields:r,searchExact:s,hint:i,searchServiceType:a}=o,c=(null==se?void 0:se[t])||{},u={useDataSource:n,displayFields:l,searchFields:r,searchExact:s,maxSuggestions:null==w?void 0:w.maxSuggestions,resultMaxNumber:H,hint:i,searchServiceType:a,configId:t};return Object.assign(c,u)},_e=o=>{if(!(null==o?void 0:o.enable)||(null==o?void 0:o.searchServiceType)===e.FeatureService)return!1;const{configId:t,hint:n,geocodeURL:l,outputDataSourceId:r,label:s,searchServiceType:i,singleLineFieldName:a}=o,c=(null==se?void 0:se[t])||{},u={hint:n,geocodeURL:l,outputDataSourceId:r,icon:null==o?void 0:o.icon,maxSuggestions:null==w?void 0:w.maxSuggestions,resultMaxNumber:H,label:s,searchServiceType:i,configId:t,singleLineFieldName:a||""};return Object.assign(c,u)},Be=(o,t)=>{var n,r;const s=se;for(const t in se){const l=null===(r=null===(n=se[t])||void 0===n?void 0:n.useDataSource)||void 0===r?void 0:r.dataSourceId;if(se[t].searchServiceType===e.GeocodeService||!V(l))continue;const i=F(l),a=q(o,se[t].searchFields||[],i,se[t].searchExact||!1);s[t].SQL=a}ae(s),((e,o)=>{const{configId:t,magicKey:n,isFromSuggestion:r}=o||{};let s=t?(0,l.Immutable)({}).setIn([t],e[t]):(0,l.Immutable)(e);for(const e in s)n&&(s=s.setIn([e,"magicKey"],n||null)),r&&(s=s.setIn([e,"isFromSuggestion"],r||null));b.current=null==s?void 0:s.asMutable({deep:!0}),re(null==s?void 0:s.asMutable({deep:!0}))})(s,t)},Ve=e=>{if(!e&&z){const e=$(D);if(0===(null==e?void 0:e.length))return!1;const o=e.map((e=>({suggestionHtml:e,suggestion:e,isRecentSearche:!0})));ue([{suggestionItem:o,layer:null,icon:null}]),oe(!0),ne(!0)}},Ue=()=>A(se),He=ee&&!Y&&!ve,Je=e=>{var o,t;40===e.keyCode&&y&&(He?null===(o=null==y?void 0:y.current)||void 0===o||o.focus():ve&&(null===(t=null==x?void 0:x.current)||void 0===t||t.focus()))};return(0,l.jsx)("div",{className:`h-100 align-items-center d-flex flex-grow-1 ${j||""}`,css:Se},(0,l.jsx)("div",{className:"h-100 flex-grow-1 search-input-con"},(0,l.jsx)("div",{className:"h-100 w-100",onKeyUp:e=>{Je(e)}},M&&(0,l.jsx)(s.TextInput,{value:W||"",onChange:e=>{var o;const t=null===(o=null==e?void 0:e.target)||void 0===o?void 0:o.value,n=(null==t?void 0:t.length)>2;if(ze(t),Oe(!1),!n)return oe(!1),!1;!Y&&Z(!0),f.current(t)},onFocus:e=>{var o;const t=null===(o=null==e?void 0:e.target)||void 0===o?void 0:o.value;Ve(t),t||!(null==w?void 0:w.isUseCurrentLoation)||ee||(oe(!0),Ve||ue([{suggestionItem:[],layer:null,icon:null}]))},onKeyUp:e=>{var o;if(!e||!e.target)return;const t=null===(o=null==e?void 0:e.target)||void 0===o?void 0:o.value;13===e.keyCode&&De()&&(ze(t),Ne(t)),Je(e)},className:"h-100 w-100",suffix:(0,l.jsx)("div",{className:"d-flex align-items-center"},Y&&(0,l.jsx)("div",{className:"loading-con mr-1"}),W&&(null==W?void 0:W.length)>0&&(0,l.jsx)(s.Button,{icon:!0,type:"tertiary",size:"sm",onClick:()=>{ze(""),ye(),Oe(!1),Ne("",!0)}},(0,l.jsx)(xe,null))),placeholder:(()=>{var e,o;let t;const n=Ue();for(const n in se)t=(null===(e=null==se?void 0:se[n])||void 0===e?void 0:e.hint)&&(null===(o=null==se?void 0:se[n])||void 0===o?void 0:o.hint);const l=(null==w?void 0:w.hint)||g("findAddressOrPlace");return t=t||g("findAddressOrPlace"),1!==n?l:t})()})),(0,l.jsx)(de,{serviceList:(0,l.Immutable)(le),canUseOutoutDsLength:Ue(),isOpen:He,reference:R,searchText:W,searchSuggestion:ce,toggel:()=>{oe(!ee)},onRecordItemClick:(e,o)=>{ze(e,o),Ne(e)},isRecentSearches:te,clearSearches:()=>{(e=>{const o=`${e}_recent_searches`;localStorage.setItem(o,"")})(D),ue([]),oe(!1),ne(!1)},isShowCurrentLocation:null==w?void 0:w.isUseCurrentLoation,setSuggestionFirstItem:e=>{y.current=e},config:w}),ve&&(0,l.jsx)(me,{serviceList:(0,l.Immutable)(le),config:w,reference:R,searchText:W,id:D,setResultFirstItem:e=>{x.current=e},isOpentResultListDefault:pe})),(0,l.jsx)(s.Button,{className:"search-button h-100",type:"primary",icon:!0,onClick:()=>{(e=>{Q===t.Style2?(E(!M),oe(!1)):De()&&Ne(e)})(W)},title:g("SearchLabel")},(0,l.jsx)(fe,null)),U===o.OtherWidgets&&(0,l.jsx)("div",{className:"search-link-con"},(0,l.jsx)(s.Link,{ref:S,to:null==$e?void 0:$e.linkTo,target:null==$e?void 0:$e.target,queryObject:p})))},De=e=>{const{datasourceConfig:o,id:t}=e;return(0,l.jsx)("div",null,null==o?void 0:o.map((e=>(e=>{const{configId:o}=e,n=null==e?void 0:e.outputDataSourceId,r=null==e?void 0:e.useDataSource,s={dataSourceId:n,mainDataSourceId:n};return(0,l.jsx)("div",{key:`${o}_con`},r&&(0,l.jsx)(l.DataSourceComponent,{useDataSource:(0,l.Immutable)(r),query:null,key:`${o}_useDataSource`,widgetId:t}),n&&(0,l.jsx)(l.DataSourceComponent,{useDataSource:(0,l.Immutable)(s),query:null,key:`${o}_outputDataSource`,widgetId:t}))})(e))))},{useEffect:Ne,useState:Ce,useRef:Me}=l.React,Pe=e=>{const{config:o,id:n}=e,s=Me(null),[i,a]=Ce((0,l.Immutable)([])),[c,u]=Ce(!1);Ne((()=>{g()}),[o]);const d=l.css`
    & {
      height: ${l.polished.rem(32)};
      margin-top: 1px;
      margin-left: 1px;
    }
  `,v=e=>{e&&a(e)},g=()=>{const e=(null==o?void 0:o.datasourceConfig)||(0,l.Immutable)([]),t=[];e.forEach((e=>{var o;const n=null===(o=e)||void 0===o?void 0:o.setIn(["enable"],!0);t.push(n)})),a((0,l.Immutable)(t))},m=()=>(null==o?void 0:o.arrangementStyle)===t.Style1||c,p=e=>{u(e)};return(0,l.jsx)(r.ViewVisibilityContext.Consumer,null,(({isInView:e,isInCurrentView:t})=>{const a=!e||t;return(0,l.jsx)(r.PageVisibilityContext.Consumer,null,(e=>{var t;return(0,l.jsx)("div",{className:"widget-search jimu-widget"},(0,l.jsx)("div",{className:"d-flex w-100 align-items-center",css:d,ref:s},(0,l.jsx)("div",null,(null===(t=null==o?void 0:o.datasourceConfig)||void 0===t?void 0:t.length)>1&&m()&&(0,l.jsx)(y,{className:"h-100",config:o,datasourceConfig:i,onDatasourceConfigChange:v})),(0,l.jsx)(Oe,{id:n,className:"flex-grow-1 h-100",reference:s,datasourceConfig:i,config:o,isShowSearchInput:m(),onShowSearchInputChange:p,isInCurrentView:a,isWidgetInCurrentPage:e}),(0,l.jsx)(De,{id:n,datasourceConfig:i})))}))}))}})(),c})())}}}));