System.register(["jimu-core","jimu-ui","jimu-for-builder","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/resource-selector","jimu-theme","jimu-ui/basic/list-tree","jimu-core/react"],(function(e,t){var o={},n={},l={},a={},i={},s={},r={},c={},u={};return{setters:[function(e){o.DataSourceComponent=e.DataSourceComponent,o.DataSourceManager=e.DataSourceManager,o.DataSourceTypes=e.DataSourceTypes,o.Immutable=e.Immutable,o.JimuFieldType=e.JimuFieldType,o.LinkType=e.LinkType,o.React=e.React,o.ReactRedux=e.ReactRedux,o.SessionManager=e.SessionManager,o.classNames=e.classNames,o.css=e.css,o.defaultMessages=e.defaultMessages,o.esri=e.esri,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.lodash=e.lodash,o.polished=e.polished,o.portalUrlUtils=e.portalUrlUtils},function(e){n.Alert=e.Alert,n.Checkbox=e.Checkbox,n.Dropdown=e.Dropdown,n.DropdownButton=e.DropdownButton,n.DropdownItem=e.DropdownItem,n.DropdownMenu=e.DropdownMenu,n.Icon=e.Icon,n.Switch=e.Switch,n.TextArea=e.TextArea,n.TextInput=e.TextInput,n.defaultMessages=e.defaultMessages,n.hooks=e.hooks},function(e){l.getAppConfigAction=e.getAppConfigAction},function(e){a.LinkSelector=e.LinkSelector,a.OpenTypes=e.OpenTypes,a.SettingCollapse=e.SettingCollapse,a.SettingRow=e.SettingRow,a.SettingSection=e.SettingSection,a.SidePopper=e.SidePopper},function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.DataSourceSelector=e.DataSourceSelector,i.FieldSelector=e.FieldSelector,i.dataComponentsUtils=e.dataComponentsUtils},function(e){s.IconPicker=e.IconPicker},function(e){r.useTheme=e.useTheme},function(e){c.List=e.List,c.TreeItemActionType=e.TreeItemActionType},function(e){u.useEffect=e.useEffect}],execute:function(){e((()=>{var e={34750:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M7.5 0a.5.5 0 00-.5.5V7H.5a.5.5 0 000 1H7v6.5a.5.5 0 001 0V8h6.5a.5.5 0 000-1H8V.5a.5.5 0 00-.5-.5z" fill="#000"></path></svg>'},79964:e=>{e.exports='<svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M8 2.125L14.334 14H1.667L8 2.125zm-.882-.47a1 1 0 011.765 0l6.333 11.874A1 1 0 0114.334 15H1.667a1 1 0 01-.882-1.47L7.118 1.653zM8 4.874a.905.905 0 00-.9.995l.35 3.507a.552.552 0 001.1 0L8.9 5.87a.905.905 0 00-.9-.995zm1 7a1 1 0 11-2 0 1 1 0 012 0z" fill="#000"></path></svg>'},40325:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M19.637 15.866L30.951 27.18a2.667 2.667 0 01-3.771 3.771L15.866 19.637 4.552 30.951A2.667 2.667 0 01.781 27.18l11.314-11.314L.781 4.552A2.667 2.667 0 014.552.781l11.314 11.314L27.18.781a2.667 2.667 0 013.771 3.771L19.637 15.866z"></path></svg>'},48891:e=>{"use strict";e.exports=o},51315:e=>{"use strict";e.exports=u},23137:e=>{"use strict";e.exports=l},34796:e=>{"use strict";e.exports=r},30726:e=>{"use strict";e.exports=n},338:e=>{"use strict";e.exports=i},20663:e=>{"use strict";e.exports=s},77756:e=>{"use strict";e.exports=a},59587:e=>{"use strict";e.exports=c}},t={};function d(o){var n=t[o];if(void 0!==n)return n.exports;var l=t[o]={exports:{}};return e[o](l,l.exports,d),l.exports}d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var o in t)d.o(t,o)&&!d.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),d.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},d.p="";var p={};return d.p=window.jimuConfig.baseUrl,(()=>{"use strict";d.r(p),d.d(p,{default:()=>ee});var e,t,o,n,l=d(48891),a=d(30726),i=d(23137),s=d(77756);!function(e){e.GeocodeService="GeocodeService",e.FeatureService="FeatureService"}(e||(e={})),function(e){e.ResultPanel="Result_Panel",e.OtherWidgets="Other_Widgets"}(t||(t={})),function(e){e.Style1="Style1",e.Style2="Style2"}(o||(o={})),function(e){e.None="",e.Init="init",e.Loading="loading",e.Loaded="loaded",e.Warning="warning",e.Error="error"}(n||(n={}));var r=d(34750),c=d.n(r);const u=e=>{const{className:t}=e,o=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(e,["className"]),n=(0,l.classNames)("jimu-icon-component",t);return l.React.createElement(a.Icon,Object.assign({className:n,icon:c()},o))},v={addSources:"Add new search sources and customize options",newSearchSource:"New search source",layerSource:"Layer source",locatorSource:"Locator source",geocodingService:"ArcGis World Geocoding Service",generalSearchOption:"General search options",multySearchHint:"Hint for multiple search sources",findAddressOrPlace:"Find address or place",searchSuggestion:"Search suggestion",searchResult:"Search result",arrangementStyle:"Arrangement style",maximumSuggestions:"Maximum suggestions per source",useCurrentLocation:"Use current location",recentSearches:"Recent searches",showSearchResult:"Show search results in",resultPanel:"Result panel",otherWidgets:"Other widgets",autoSelect:"Auto select the first result",redirectSearchResult:"Redirect if search result is not empty",notSetCorrectle:"The search or display field is not set correctly.",searchOption:"Search options",selectSearchFields:"Select searching fields",selectedField:"{fieldNumber} Selected",searchHint:"Hint",searchOptions:"Search options",exactMatch:"Exact match",displayFields:"Display fields",searchIcon:"Icon",setLayerSource:"Set layer source",setLocatorSource:"Set locator source",locatorUrl:"Locator URL",searchExample:"Example: {url}",enterUrl:"Enter URL (HTTPS only)",onluSupportedHTTPS:"Only HTTPS is supported",locatorSourceErrorHint:"The URL you entered is invalid or inaccessible",locatorUrlError:"Locator URL is not set correctly",invalidUrl:"An invalid URL",maximumNumber:"Maximum number",maximumResults:"Maximum display results per source",outputDsLabel:"{label} result",exampleUrl:"Example: {url}",searchBoxTip:"Search box",searchIconTip:"Search icon"};var m=d(338),g=d(20663);const S="objectid",h="address",f="https://geocode.arcgis.com/arcgis/rest/services/World/GeocodeServer",x="ArcGIS World Geocoding Service",y=e=>b(e)?x:I(e),I=e=>{if(!e)return"geocoder";const t=e.split("/");return t[t.length-2]||"geocoder"},b=e=>!!e&&/(?:arcgis\.com\/arcgis\/rest\/services\/world\/geocodeserver).*/gi.test(e),w={jimuName:S,alias:"OBJECTID",type:l.JimuFieldType.Number,name:S},T={jimuName:h,alias:"ADDRESS",type:l.JimuFieldType.String,name:h},C=(e="")=>({label:e,idField:S,fields:{[S]:w,[h]:T}}),j=(e,t)=>{var o;return(null===(o=t.filter((t=>(null==t?void 0:t.dataSourceId)===(null==e?void 0:e.dataSourceId))))||void 0===o?void 0:o.length)>0},R=e=>null==e?void 0:e.map((e=>e.configId)),D=e=>e&&0!==(null==e?void 0:e.length)?`config_${O(e)+1}`:"config_0",O=e=>{var t;const o=null==e?void 0:e.map((e=>{var t;const o=null===(t=null==e?void 0:e.split("_"))||void 0===t?void 0:t.pop();return o?Number(o):0}));return null===(t=null==o?void 0:o.sort(((e,t)=>t-e)))||void 0===t?void 0:t[0]},N=(e,t)=>{var o;if(!e)return`${t}_output_0`;const n=null===(o=null==e?void 0:e.split("_"))||void 0===o?void 0:o.pop();return`${t}_output_${Number(n)}`};var L=d(34796),P=d(59587);const k=e=>{const t={overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:P.TreeItemActionType.RenderOverrideItem,children:[{name:P.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:P.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:P.TreeItemActionType.RenderOverrideItemBody,children:[{name:P.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:P.TreeItemActionType.RenderOverrideItemDragHandle},{name:P.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:P.TreeItemActionType.RenderOverrideItemTitle},{name:P.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})},o=l.css`
    &{
      max-height: 256px;
      overflow-y: auto;
    }
  `,n=(0,L.useTheme)(),{disPlayField:a,useDataSource:i,onFieldChange:s}=e;return(0,l.jsx)("div",{className:"w-100"},(0,l.jsx)(m.FieldSelector,{useDataSources:i?(0,l.Immutable)([i]):(0,l.Immutable)([]),onChange:e=>{s(e,a,!0)},selectedFields:(0,l.Immutable)(null==a?void 0:a.map((e=>null==e?void 0:e.name))),isMultiple:!0,isSearchInputHidden:!1,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,types:(0,l.Immutable)([l.JimuFieldType.Number,l.JimuFieldType.String])}),(0,l.jsx)("div",{css:o},(0,l.jsx)(P.List,Object.assign({size:"sm",className:"mt-2",itemsJson:Array.from(a).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${null==e?void 0:e.name}${t}`,itemStateIcon:m.dataComponentsUtils.getIconFromFieldType(e.type,n),itemStateTitle:e.alias||e.jimuName||e.name,itemStateCommands:[]}))),dndEnabled:!0,onUpdateItem:(e,t)=>{const{itemJsons:o}=t.props,[,n]=o,l=n.map((e=>e.itemStateDetailContent));s(l,a,!0)},isItemFocused:()=>!1},t))))},{useEffect:F}=l.React,A=(0,l.Immutable)([m.AllDataSourceTypes.FeatureLayer,m.AllDataSourceTypes.SceneLayer]),M=t=>{var o,n;const i=a.hooks.useTranslate(v,a.defaultMessages,l.defaultMessages),{trigger:r,isOpen:c,id:u,config:d,dsConfigItemIndex:p,popperFocusNode:S,toggle:h,updateConfigForLayerOptions:f,onSettingChange:x}=t,y=(null===(o=null==d?void 0:d.datasourceConfig)||void 0===o?void 0:o[p])||(0,l.Immutable)({}),{configId:I,label:b,icon:w,searchFields:T,searchExact:C,displayFields:j,hint:O,useDataSource:N}=y,[L,P]=l.React.useState(null),[M,U]=l.React.useState(b);F((()=>{I&&U(b)}),[I]);const E=(t,o)=>{var n;const l=R(null===(n=null==d?void 0:d.datasourceConfig)||void 0===n?void 0:n.asMutable({deep:!0})),a=I||D(l);let i=(null==d?void 0:d.datasourceConfig)?d.datasourceConfig.asMutable({deep:!0}):[];const s=null==t?void 0:t.getLabel(),r=H(o),c={configId:a,icon:null,label:s,displayLabel:!0,useDataSource:o,displayFields:r,searchFields:r,hint:"",searchServiceType:e.FeatureService};return(null==y?void 0:y.configId)?i=i.map((e=>(null==e?void 0:e.configId)===a?c:e)):i.push(c),{dsConfigItem:c,datasourceConfig:i}},H=e=>{var t,o,n,a;const i=l.DataSourceManager.getInstance().getDataSource(null==e?void 0:e.dataSourceId),s=null===(t=i.getLayerDefinition())||void 0===t?void 0:t.displayField,r=null===(o=null==i?void 0:i.getSchema())||void 0===o?void 0:o.fields;let c;const u=[];for(const e in r)(null===(n=null==r?void 0:r[e])||void 0===n?void 0:n.type)!==l.JimuFieldType.Date&&u.push(null==r?void 0:r[e]),(null===(a=null==r?void 0:r[e])||void 0===a?void 0:a.name)===s&&(c=null==r?void 0:r[e]);const d=(null==u?void 0:u.length)>1?u[1]:u[0];return c?[(0,l.Immutable)(c)]:[(0,l.Immutable)(d)]},B=(e,t,o=!1)=>{var n,a,i;if(!e)return;const s=o?"displayFields":"searchFields";let r=z(e);0===(null==r?void 0:r.length)&&(r=null===(a=null===(n=(0,l.Immutable)(t))||void 0===n?void 0:n.asMutable({deep:!0}))||void 0===a?void 0:a.splice(0,1));const c=null===(i=null==d?void 0:d.datasourceConfig)||void 0===i?void 0:i.asMutable({deep:!0}),v=null==y?void 0:y.setIn([s],r);null==c||c.splice(p,1,null==v?void 0:v.asMutable({deep:!0}));const m=d.setIn(["datasourceConfig"],c);x({id:u,config:m})},z=e=>null==e?void 0:e.filter((e=>(null==e?void 0:e.type)!==(null===l.JimuFieldType||void 0===l.JimuFieldType?void 0:l.JimuFieldType.Date))),J=(e,t)=>{var o;const n=null===(o=null==d?void 0:d.datasourceConfig)||void 0===o?void 0:o.asMutable({deep:!0}),l=null==y?void 0:y.setIn(e,t);null==n||n.splice(p,1,null==l?void 0:l.asMutable({deep:!0}));const a=d.setIn(["datasourceConfig"],n);x({id:u,config:a})},_=(null==y?void 0:y.useDataSource)?[null===(n=null==y?void 0:y.useDataSource)||void 0===n?void 0:n.asMutable({deep:!0})]:[];return(0,l.jsx)(s.SidePopper,{isOpen:c,position:"right",toggle:h,trigger:r,title:i("setLayerSource"),backToFocusNode:S},(0,l.jsx)("div",{className:"w-100",css:l.css`height: calc(100% - 40px);overflow: auto;`},(0,l.jsx)(s.SettingSection,{style:{paddingTop:0}},(0,l.jsx)(s.SettingRow,{flow:"wrap",label:i("data")},(0,l.jsx)(m.DataSourceSelector,{closeDataSourceListOnChange:!0,types:A,useDataSources:(0,l.Immutable)(_),disableRemove:()=>!0,mustUseDataSource:!0,onChange:e=>{e&&e.length>0&&(e=>{l.DataSourceManager.getInstance().createDataSourceByUseDataSource((0,l.Immutable)(e)).then((e=>{const t=(o=e)?o.type===l.DataSourceTypes.SceneLayer?o.getAssociatedDataSource():o:null;var o;return t||Promise.reject(Error("")),t})).then((t=>{const{datasourceConfig:o}=E(t,e),n=d.setIn(["datasourceConfig"],o);f(n)}))})(e[0])},widgetId:u}))),(null==y?void 0:y.configId)&&L&&(0,l.jsx)("div",null,(0,l.jsx)(s.SettingSection,null,(0,l.jsx)(s.SettingRow,{flow:"wrap",label:i("label")},(0,l.jsx)(a.TextInput,{size:"sm",value:M||"",onAcceptValue:e=>{e?(U(null==e?void 0:e.trim()),J(["label"],null==e?void 0:e.trim())):U(b)},onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;U(o)},className:"w-100",placeholder:i("findAddressOrPlace")}))),(0,l.jsx)(s.SettingSection,null,(0,l.jsx)(s.SettingRow,{label:i("searchIcon")},(0,l.jsx)(g.IconPicker,{icon:w,onChange:e=>{J(["icon"],e)},configurableOption:"none"}))),(0,l.jsx)(s.SettingSection,{title:i("searchOptions")},(0,l.jsx)(s.SettingRow,{flow:"wrap",label:i("selectSearchFields")},(0,l.jsx)(m.FieldSelector,{useDataSources:N?(0,l.Immutable)([N]):(0,l.Immutable)([]),onChange:e=>{B(e,T)},selectedFields:(0,l.Immutable)(null==T?void 0:T.map((e=>null==e?void 0:e.name))),isMultiple:!0,isSearchInputHidden:!1,isDataSourceDropDownHidden:!0,useDropdown:!0,useMultiDropdownBottomTools:!0,types:(0,l.Immutable)([l.JimuFieldType.Number,l.JimuFieldType.String])}),(0,l.jsx)("div",{className:"mt-2"},(0,l.jsx)(a.Checkbox,{checked:C,onClick:e=>{const t=e.currentTarget;t&&J(["searchExact"],t.checked)},className:"mr-1"})," ",i("exactMatch"))),(0,l.jsx)(s.SettingRow,{flow:"wrap",label:i("displayFields")},(0,l.jsx)(k,{disPlayField:j||[],onFieldChange:B,useDataSource:N})),(0,l.jsx)(s.SettingRow,{flow:"wrap",label:i("searchHint")},(0,l.jsx)(a.TextInput,{size:"sm",value:O||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;J(["hint"],o)},className:"w-100",placeholder:i("findAddressOrPlace")})))),(null==_?void 0:_[0])&&(0,l.jsx)("div",{className:"waiting-for-database"},(0,l.jsx)(l.DataSourceComponent,{useDataSource:(0,l.Immutable)(_[0]),onDataSourceCreated:e=>{P(e)}}))))};var U=d(79964),E=d.n(U);const H=e=>{const{className:t}=e,o=function(e,t){var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(n=Object.getOwnPropertySymbols(e);l<n.length;l++)t.indexOf(n[l])<0&&Object.prototype.propertyIsEnumerable.call(e,n[l])&&(o[n[l]]=e[n[l]])}return o}(e,["className"]),n=(0,l.classNames)("jimu-icon-component",t);return l.React.createElement(a.Icon,Object.assign({className:n,icon:E()},o))};const{useEffect:B,useRef:z}=l.React,J=new(0,l.esri.Sanitizer);var _;!function(e){e.Pass="Pass",e.NotHttps="Not_Https",e.InvalidURL="Invalid_URL"}(_||(_={}));const G=t=>{var o,n,i,r,c,u,d;const p=a.hooks.useTranslate(v,a.defaultMessages,l.defaultMessages),m=z((e=>{})),S=(0,L.useTheme)(),{id:h,trigger:I,toggle:b,isOpen:w,config:T,dsConfigItemIndex:C,popperFocusNode:j,onSettingChange:O,updateConfigForLayerOptions:N}=t,P=(null===(o=null==T?void 0:T.datasourceConfig)||void 0===o?void 0:o[C])||(0,l.Immutable)({}),{configId:k,label:F,icon:A,geocodeURL:M,hint:U}=P,[E,G]=l.React.useState(M),[W,$]=l.React.useState(!1),[V,q]=l.React.useState(F),[K,Q]=l.React.useState(_.Pass);B((()=>{w&&((null==P?void 0:P.geocodeURL)?($(!0),Q(_.Pass),G(M),q(null==P?void 0:P.label)):($(!1),G(""),q(x),K===_.Pass&&Q(_.InvalidURL)))}),[C,k,w]),B((()=>{m.current=l.lodash.debounce((e=>{X(e).then((e=>{!W&&$(!0),Q(null==e?void 0:e.urlCheckResultType)})).catch((e=>{Q(_.InvalidURL)}))}),500)}),[]);const X=e=>{return t=void 0,o=void 0,a=function*(){const t=new RegExp("^(([h][t]{2}[p][s])?://)");if(!e||!t.test(e))return Promise.resolve({urlCheckResultType:_.NotHttps});try{return(0,l.loadArcGISJSAPIModules)(["esri/request"]).then((t=>{const[o]=t;return o(e,{query:{f:"json"},responseType:"json"}).then((e=>{const t=(null==e?void 0:e.data)||{};if(null==t?void 0:t.capabilities){const e=(null==t?void 0:t.singleLineAddressField)||{};return Promise.resolve({urlCheckResultType:_.Pass,singleLineFieldName:null==e?void 0:e.name})}return Promise.resolve({urlCheckResultType:_.InvalidURL})}))}))}catch(e){return Promise.resolve({urlCheckResultType:_.InvalidURL})}},new((n=void 0)||(n=Promise))((function(e,l){function i(e){try{r(a.next(e))}catch(e){l(e)}}function s(e){try{r(a.throw(e))}catch(e){l(e)}}function r(t){var o;t.done?e(t.value):(o=t.value,o instanceof n?o:new n((function(e){e(o)}))).then(i,s)}r((a=a.apply(t,o||[])).next())}));var t,o,n,a},Y=(e,t)=>{var o;const n=null===(o=null==T?void 0:T.datasourceConfig)||void 0===o?void 0:o.asMutable({deep:!0}),l=null==P?void 0:P.setIn(e,t);null==n||n.splice(C,1,null==l?void 0:l.asMutable({deep:!0}));const a=T.setIn(["datasourceConfig"],n);O({id:h,config:a})},Z=J.sanitize(p("exampleUrl",{url:`${f}`}));return(0,l.jsx)(s.SidePopper,{isOpen:w,position:"right",toggle:b,trigger:I,title:p("setLocatorSource"),backToFocusNode:j},(0,l.jsx)("div",{className:"w-100",css:l.css`height: calc(100% - 40px);overflow: auto;`},(0,l.jsx)(s.SettingSection,{style:{paddingTop:0}},(0,l.jsx)(s.SettingRow,{flow:"wrap",label:p("locatorUrl")},(0,l.jsx)(a.TextArea,{placeholder:p("enterUrl"),value:E||"",style:{minHeight:l.polished.rem(100)},onChange:e=>{const t=e.target.value;G(t),m.current(t)},onBlur:t=>{var o;const n=t.target.value;null===(o=m.current)||void 0===o||o.cancel(),X(n).then((t=>{(null==t?void 0:t.urlCheckResultType)===_.Pass?(Q(null==t?void 0:t.urlCheckResultType),((t,o)=>{var n;const l=R(null===(n=null==T?void 0:T.datasourceConfig)||void 0===n?void 0:n.asMutable({deep:!0})),a=k||D(l);let i=(null==T?void 0:T.datasourceConfig)?T.datasourceConfig.asMutable({deep:!0}):[];const s=y(t),r={configId:a,icon:null,label:s,hint:"",outputDataSourceId:`${h}_output_${a}`,geocodeURL:t,searchServiceType:e.GeocodeService,singleLineFieldName:o};(null==P?void 0:P.configId)?i=i.map((e=>(null==e?void 0:e.configId)===a?r:e)):i.push(r);const c=T.setIn(["datasourceConfig"],i);N(c)})(n,null==t?void 0:t.singleLineFieldName)):M&&(Q(_.Pass),G(M))})).catch((e=>{Q(_.Pass),G(M)}))}}),(0,l.jsx)("div",{className:"mt-2 text-break"},(0,l.jsx)("i",{style:{fontSize:l.polished.rem(12),color:null===(i=null===(n=S.colors)||void 0===n?void 0:n.palette)||void 0===i?void 0:i.dark[500]},dangerouslySetInnerHTML:{__html:Z}})),K!==_.Pass&&W&&(0,l.jsx)("div",{className:"d-flex w-100 align-items-center justify-content-between mt-1"},(0,l.jsx)(H,{size:16,color:null===(c=null===(r=S.colors)||void 0===r?void 0:r.palette)||void 0===c?void 0:c.danger[500]}),(0,l.jsx)("div",{style:{width:"calc(100% - 20px)",margin:"0 4px",overflow:"hidden",textOverflow:"ellipsis",color:null===(d=null===(u=S.colors)||void 0===u?void 0:u.palette)||void 0===d?void 0:d.danger[500]}},K===_.NotHttps?p("onluSupportedHTTPS"):p("invalidUrlMessage"))))),K===_.Pass&&k&&(0,l.jsx)("div",null,(0,l.jsx)(s.SettingSection,null,(0,l.jsx)(s.SettingRow,{flow:"wrap",label:p("label")},(0,l.jsx)(a.TextInput,{size:"sm",value:V||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;q(o)},onAcceptValue:e=>{e?(q(null==e?void 0:e.trim()),Y(["label"],null==e?void 0:e.trim())):q(F)},className:"w-100",placeholder:p("findAddressOrPlace")}))),(0,l.jsx)(s.SettingSection,null,(0,l.jsx)(s.SettingRow,{label:p("searchIcon")},(0,l.jsx)(g.IconPicker,{icon:A,onChange:e=>{Y(["icon"],e)},configurableOption:"none"}))),(0,l.jsx)(s.SettingSection,{title:p("searchOptions")},(0,l.jsx)(s.SettingRow,{flow:"wrap",label:p("searchHint")},(0,l.jsx)(a.TextInput,{size:"sm",value:U||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;Y(["hint"],o)},className:"w-100",placeholder:p("findAddressOrPlace")}))))))},W=d(40325),$=t=>{const o=a.hooks.useTranslate(l.defaultMessages,a.defaultMessages),{className:n,datasourceConfig:i,useDataSources:s,config:r,dsConfigItemIndex:c,showSourcePanel:u,showNewSourceItem:d,id:p,onDsConfigIdChange:v,updateConfigForLayerOptions:m,hideSidePopper:g}=t,S=l.ReactRedux.useSelector((e=>{var t,o,n;return null===(n=null===(o=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===o?void 0:o.widgets)||void 0===n?void 0:n[p]})),h={isItemFocused:(e,t)=>{const{itemJsons:[o,n]}=t.props;return u&&n.indexOf(o)===c},overrideItemBlockInfo:({itemBlockInfo:e},t)=>({name:P.TreeItemActionType.RenderOverrideItem,children:[{name:P.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:P.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:P.TreeItemActionType.RenderOverrideItemBody,children:[{name:P.TreeItemActionType.RenderOverrideItemMainLine,children:[{name:P.TreeItemActionType.RenderOverrideItemDragHandle},{name:P.TreeItemActionType.RenderOverrideItemIcon,autoCollapsed:!0},{name:P.TreeItemActionType.RenderOverrideItemTitle},{name:P.TreeItemActionType.RenderOverrideItemDetailToggle},{name:P.TreeItemActionType.RenderOverrideItemCommands}]}]}]}]}]})};return(0,l.jsx)("div",{className:`w-100 mt-2 ${n||""}`},(0,l.jsx)(P.List,Object.assign({className:"w-100",itemsJson:Array.from(i).map(((e,t)=>{var n;return{itemStateDetailContent:e,itemKey:`${t}`,itemStateTitle:null==e?void 0:e.label,itemStateIcon:{icon:null===(n=e.icon)||void 0===n?void 0:n.svg},itemStateCommands:[{label:o("deleteOption"),iconProps:()=>({icon:W,size:12}),action:()=>{(e=>{const t=null==i?void 0:i.asMutable({deep:!0});null==t||t.splice(e,1);const o=r.setIn(["datasourceConfig"],t);m(o),g()})(t)}}]}})),dndEnabled:!0,renderOverrideItemDetailToggle:(t,n)=>{var i;const{itemJsons:r}=n.props,[c]=r,u=null==c?void 0:c.itemStateDetailContent,d=(null==u?void 0:u.searchServiceType)===e.GeocodeService;return((e,t=!1)=>{let o;if(t){const t=(null==S?void 0:S.outputDataSources)||[];o=(null==t?void 0:t.filter((t=>e===t)).length)>0}else o=(null==s?void 0:s.filter((t=>e===t.dataSourceId)).length)>0;return o&&e})(d?null==u?void 0:u.outputDataSourceId:null===(i=null==u?void 0:u.useDataSource)||void 0===i?void 0:i.dataSourceId,d)?"":(0,l.jsx)(a.Alert,{buttonType:"tertiary",form:"tooltip",size:"small",type:"error",text:o("dataSourceCreateError")})},onUpdateItem:(e,t)=>{const{itemJsons:o}=t.props,[,n]=o,l=n.map((e=>e.itemStateDetailContent)),a=r.setIn(["datasourceConfig"],l);v(null),m(a)},onClickItemBody:(t,o)=>{var n;const{itemJsons:[l]}=o.props,a=(null===(n=null==l?void 0:l.itemStateDetailContent)||void 0===n?void 0:n.searchServiceType)===e.GeocodeService;v(+l.itemKey,a)}},h)),d&&(0,l.jsx)(P.List,Object.assign({className:"setting-ui-unit-list-new",itemsJson:[{name:"......"}].map(((e,t)=>({itemStateDetailContent:"item",itemKey:"index",itemStateTitle:"......",itemStateCommands:[]}))),dndEnabled:!1,renderOverrideItemDetailToggle:()=>""},h,{isItemFocused:()=>!0})))},{useSelector:V}=l.ReactRedux,{useRef:q,useEffect:K}=l.React,Q=t=>{var o,n,r,c,d,p;const m=a.hooks.useTranslate(v,a.defaultMessages,l.defaultMessages),g=(0,L.useTheme)(),{config:S,id:h,useDataSources:f,onSettingChange:x}=t,y=q(null),I=q(null),[b,w]=l.React.useState(!1),[T,R]=l.React.useState(!1),[D,O]=l.React.useState(!1),[N,P]=l.React.useState(!1),[k,F]=l.React.useState(null),[A,U]=l.React.useState(null),E=V((e=>{var t,o,n;return null===(n=null===(o=null===(t=null==e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===o?void 0:o.widgets)||void 0===n?void 0:n[h]})),H=l.css`
    & {
      background-color: ${null===(r=null===(n=null===(o=g.colors)||void 0===o?void 0:o.palette)||void 0===n?void 0:n.secondary)||void 0===r?void 0:r[400]};
    }
  `,B=l.css`
    .data-remind {
      color: ${null===(p=null===(d=null===(c=g.colors)||void 0===c?void 0:c.palette)||void 0===d?void 0:d.dark)||void 0===p?void 0:p[500]};
      font-size: ${l.polished.rem(12)};
    }
  `;K((()=>{z()}),[S]);const z=()=>{const t=(null==E?void 0:E.outputDataSources)||[],o=(null==S?void 0:S.datasourceConfig)||[];for(const n in o){const l=o[n];if((null==l?void 0:l.searchServiceType)===e.FeatureService)continue;const a=null==l?void 0:l.outputDataSourceId;if(!(null==t?void 0:t.includes(a))){W(S);break}}},J=()=>{O(!1),R(!1),F(null)},_=e=>{var t;const o=e?!D:!T;if(P(o),o){const e=(null===(t=null==S?void 0:S.datasourceConfig)||void 0===t?void 0:t.length)||0;F(e),ee(e,!0)}e?R(o):O(o)},W=e=>{Z(e)&&P(!1);const t=Q(null==e?void 0:e.datasourceConfig);Y(t),x({id:h,config:e},t.outputDataSources)},Q=e=>{var t;return null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.reduce(((e,t)=>{const o=null==t?void 0:t.useDataSource;o&&!j(o,null==e?void 0:e.useDataSources)&&(null==e||e.useDataSources.push(o));const n=X(t);return n&&e.outputDataSources.push(n),e}),{useDataSources:[],outputDataSources:[]})},X=t=>{let o;return(null==t?void 0:t.searchServiceType)===e.GeocodeService&&(o={id:null==t?void 0:t.outputDataSourceId,type:l.DataSourceTypes.FeatureLayer,label:null==t?void 0:t.label,originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:C(null==t?void 0:t.label),geometryType:"esriGeometryPoint"}),o},Y=e=>{var t;const o={id:h},n=(0,i.getAppConfigAction)();o.useDataSources=null==e?void 0:e.useDataSources,o.outputDataSources=null===(t=null==e?void 0:e.outputDataSources)||void 0===t?void 0:t.map((e=>null==e?void 0:e.id)),((e,t,o)=>{var n,l,a,i;const s=(null===(n=null==e?void 0:e.useDataSources)||void 0===n?void 0:n.asMutable({deep:!0}))||[],r=(null===(l=null==e?void 0:e.outputDataSources)||void 0===l?void 0:l.asMutable({deep:!0}))||[];if((null==s?void 0:s.length)!==(null==t?void 0:t.length)||(null==r?void 0:r.length)!==(null==o?void 0:o.length))return!0;const c=(null===(a=null==t?void 0:t.filter((e=>!j(e,s))))||void 0===a?void 0:a.length)>0,u=(null===(i=r.filter((e=>!(null==o?void 0:o.includes(e)))))||void 0===i?void 0:i.length)>0;return c||u})(E,o.useDataSources,o.outputDataSources)&&n.editWidget(o).exec()},Z=e=>{var t,o;return(null===(t=null==e?void 0:e.datasourceConfig)||void 0===t?void 0:t.length)!==(null===(o=null==S?void 0:S.datasourceConfig)||void 0===o?void 0:o.length)},ee=(e,t=!1)=>{let o;o=t?I.current.getElementsByClassName("add-search-btn")[0]:I.current.getElementsByClassName("jimu-tree-item__body")[e],U(o)};return(0,l.jsx)(s.SettingSection,{css:B},(0,l.jsx)(s.SettingRow,{flow:"wrap"},(0,l.jsx)("span",{className:"w-100 data-remind"},m("addSources"))),(0,l.jsx)(s.SettingRow,{flow:"wrap"},(0,l.jsx)("div",{className:"w-100",ref:I},(0,l.jsx)(a.Dropdown,{className:"w-100",size:"sm",toggle:()=>{w(!b)},isOpen:b,autoWidth:!0},(0,l.jsx)(a.DropdownButton,{className:"add-search-btn w-100",arrow:!1,icon:!0,type:"primary"},(0,l.jsx)(u,{className:"mr-1 d-inline-block",autoFlip:!0}),m("newSearchSource")),(0,l.jsx)(a.DropdownMenu,{css:H},(0,l.jsx)(a.DropdownItem,{className:"w-100",onClick:()=>{_(!0)}},m("layerSource")),(0,l.jsx)(a.DropdownItem,{className:"w-100",onClick:()=>{_(!1)}},m("locatorSource")))),(0,l.jsx)("div",{className:"w-100",ref:y},(0,l.jsx)($,{id:h,dsConfigItemIndex:k,datasourceConfig:(null==S?void 0:S.datasourceConfig)||(0,l.Immutable)([]),config:S,showSourcePanel:(()=>{var t,o;return(null===(o=null===(t=null==S?void 0:S.datasourceConfig)||void 0===t?void 0:t[k])||void 0===o?void 0:o.searchServiceType)===e.GeocodeService?D:T})(),useDataSources:f,onDsConfigIdChange:(e,t)=>{"number"==typeof e?(ee(e,!1),k===e?t?(O(!D),R(!1)):(R(!T),O(!1)):(F(e),t?(O(!0),R(!1)):(R(!0),O(!1)))):J()},showNewSourceItem:N,updateConfigForLayerOptions:W,hideSidePopper:J}))),(0,l.jsx)(M,{id:h,dsConfigItemIndex:k,useDataSources:f,isOpen:T,config:S,onSettingChange:x,trigger:null==y?void 0:y.current,updateConfigForLayerOptions:W,toggle:()=>{R(!T),P(!1)},popperFocusNode:A}),(0,l.jsx)(G,{id:h,dsConfigItemIndex:k,useDataSources:f,isOpen:D,onSettingChange:x,updateConfigForLayerOptions:W,config:S,trigger:null==y?void 0:y.current,toggle:()=>{O(!D),P(!1)},popperFocusNode:A})))},X=e=>{const o=a.hooks.useTranslate(v,a.defaultMessages,l.defaultMessages),n=(0,L.useTheme)(),i=l.css`
    .check-box-label {
      color: ${n.colors.palette.dark[800]}
    }
    .search-setting-con {
      padding-left: 0;
      padding-right: 0;
    }
    .divider-line {
      padding-bottom: 0;
    }
    .checkbox-con .jimu-widget-setting--row-label{
      max-width: 100%;
    }
  `,{config:r,id:c,useDataSources:u,onSettingChange:d}=e,{searchResultView:p,hint:m,maxSuggestions:g,isUseCurrentLoation:S,isShowRecentSearches:h,recentSearchesMaxNumber:f,resultMaxNumber:x,linkParam:y,isAutoSelectFirstResult:I}=r,[b,w]=l.React.useState(!1),[T,C]=l.React.useState(!1),[j,R]=l.React.useState(m),[D,O]=l.React.useState(f),[N,P]=l.React.useState(g),[k,F]=l.React.useState(x),A=(e,t)=>{d({id:c,config:r.setIn(e,t)})},M=e=>0===(null==e?void 0:e.length)||Number(e)&&Number(e)>0;return(0,l.jsx)(s.SettingSection,{title:o("generalSearchOption"),css:i},(0,l.jsx)(s.SettingRow,{flow:"wrap",label:o("multySearchHint")},(0,l.jsx)(a.TextInput,{size:"sm",value:j||"",onChange:e=>{var t;const o=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value;R(o)},onAcceptValue:e=>{R(e),A(["hint"],e)},className:"w-100",placeholder:o("findAddressOrPlace")})),(0,l.jsx)("div",null,(0,l.jsx)(s.SettingSection,{className:"search-setting-con"},(0,l.jsx)(s.SettingRow,null,(0,l.jsx)(s.SettingCollapse,{label:o("searchSuggestion"),isOpen:b,onRequestOpen:()=>w(!0),onRequestClose:()=>w(!1),level:1},(0,l.jsx)(s.SettingRow,{flow:"wrap",className:"mt-2 checkbox-con",label:o("maximumSuggestions")},(0,l.jsx)(a.TextInput,{size:"sm",value:N,onChange:e=>{const t=e.target.value;M(t)&&P(t)},onAcceptValue:e=>{e||P(e=g||6),M(e)&&A(["maxSuggestions"],Number(e))},className:"w-100"})),(0,l.jsx)(s.SettingRow,null,(0,l.jsx)(a.Checkbox,{checked:S,onClick:e=>{const t=e.currentTarget;t&&A(["isUseCurrentLoation"],t.checked)},className:"mr-1","aria-label":o("useCurrentLocation")}),(0,l.jsx)("span",{className:"check-box-label"},o("useCurrentLocation"))),(0,l.jsx)(s.SettingRow,{label:o("recentSearches")},(0,l.jsx)(a.Switch,{checked:h||!1,onChange:e=>{A(["isShowRecentSearches"],!h)}})),h&&(0,l.jsx)(s.SettingRow,{label:o("maximumNumber")},(0,l.jsx)(a.TextInput,{size:"sm",value:D,onChange:e=>{const t=e.target.value;M(t)&&O(t)},onAcceptValue:e=>{e||O(e=f||6),M(e)&&A(["recentSearchesMaxNumber"],Number(e))},style:{width:"50px"}}))))),b&&(0,l.jsx)(s.SettingSection,{className:"divider-line"})),(0,l.jsx)(s.SettingRow,null,(0,l.jsx)(s.SettingCollapse,{label:o("searchResult"),isOpen:T,onRequestOpen:()=>C(!0),onRequestClose:()=>C(!1),level:1},(0,l.jsx)(s.SettingRow,{label:o("resultPanel"),className:"mt-2"},(0,l.jsx)(a.Switch,{checked:p===t.ResultPanel,onChange:e=>{(e=>{const o=e?t.ResultPanel:t.OtherWidgets;A(["searchResultView"],o)})(p===t.OtherWidgets)}})),p===t.ResultPanel&&(0,l.jsx)(s.SettingRow,{flow:"wrap",className:"checkbox-con",label:o("maximumResults")},(0,l.jsx)(a.TextInput,{size:"sm",value:k,onChange:e=>{const t=e.target.value;M(t)&&F(t)},onAcceptValue:e=>{e||F(e=x||6),M(e)&&A(["resultMaxNumber"],Number(e))},className:"w-100"})),p===t.ResultPanel&&(0,l.jsx)(s.SettingRow,null,(0,l.jsx)(a.Checkbox,{checked:I,onClick:e=>{const t=e.currentTarget;t&&A(["isAutoSelectFirstResult"],t.checked)},className:"mr-1","aria-label":o("autoSelect")}),(0,l.jsx)("span",{className:"check-box-label"},o("autoSelect"))),p===t.OtherWidgets&&(0,l.jsx)(s.SettingRow,{className:"d-block",flow:"wrap",label:o("redirectSearchResult")},(0,l.jsx)(s.LinkSelector,{onSettingConfirm:e=>{e&&A(["linkParam"],e)},linkParam:y,useDataSources:u,widgetId:c,hiddenLinks:(0,l.Immutable)([l.LinkType.Block,l.LinkType.Dialog,l.LinkType.PageTop,l.LinkType.Screen,l.LinkType.View,l.LinkType.WebAddress]),openTypes:(0,l.Immutable)([s.OpenTypes.CurrentWindow])})))))};var Y=d(51315);const Z={name:x,url:f},ee=t=>{const{config:o,id:n,portalUrl:a,onSettingChange:i,useDataSources:s}=t,r=l.ReactRedux.useSelector((e=>{var t,o;return null===(o=null===(t=null==e?void 0:e.asMutable({deep:!0}))||void 0===t?void 0:t.appStateInBuilder)||void 0===o?void 0:o.portalSelf}));(0,Y.useEffect)((()=>{!(null==o?void 0:o.datasourceConfig)&&c()}),[]);const c=()=>{d().then((e=>{u(e)})).catch((e=>{u([Z])}))},u=t=>{const a=[],s=[],r=[];null==t||t.forEach((t=>{const o=D(a),i=((e,t,o,n)=>{const a=n||y(o),i=N(t,e),s=C(n);return{id:i,type:l.DataSourceTypes.FeatureLayer,label:a,originDataSources:[],isOutputFromWidget:!0,isDataInDataSourceInstance:!1,schema:s,geometryType:"esriGeometryPoint"}})(n,o,t.url,null==t?void 0:t.name),c={configId:(u={configId:o,id:n,hint:"",label:null==t?void 0:t.name,geocodeServiceUrl:t.url,singleLineFieldName:t.singleLineFieldName}).configId,label:(null==u?void 0:u.label)||y(u.geocodeServiceUrl),geocodeURL:u.geocodeServiceUrl,outputDataSourceId:N(u.configId,u.id),useDataSource:null,hint:null==u?void 0:u.hint,searchServiceType:e.GeocodeService,singleLineFieldName:null==u?void 0:u.singleLineFieldName};var u;a.push(o),s.push(c),r.push(i)}));let c=null==o?void 0:o.setIn(["datasourceConfig"],s);c=null==c?void 0:c.setIn(["hint"],""),i({id:n,config:c},r)},d=()=>{var e,t;return(null===(e=null==r?void 0:r.helperServices)||void 0===e?void 0:e.geocode)?Promise.resolve(p(null===(t=null==r?void 0:r.helperServices)||void 0===t?void 0:t.geocode)):(e=>{const t=l.esri.restRequest.request,o=l.SessionManager.getInstance();return t(`${l.portalUrlUtils.getPortalRestUrl(e)}portals/self`,{authentication:o.getMainSession(),httpMethod:"GET"}).then((e=>{var t;return Promise.resolve((null===(t=null==e?void 0:e.helperServices)||void 0===t?void 0:t.geocode)||[])})).catch((e=>Promise.resolve([])))})(a).then((e=>Promise.resolve(p(e))),(e=>Promise.resolve([Z])))},p=e=>{var t;const o=e||[];return(null===(t=null==o?void 0:o.filter((e=>(null==e?void 0:e.url)===f)))||void 0===t?void 0:t.length)>0||o.unshift(Z),o};return(0,l.jsx)("div",{className:"widget-setting-search jimu-widget-search"},(0,l.jsx)(Q,{id:n,useDataSources:s,onSettingChange:i,config:o}),(0,l.jsx)(X,{id:n,config:o,onSettingChange:i,useDataSources:s}))}})(),p})())}}}));